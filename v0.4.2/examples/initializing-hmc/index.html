<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Initializing HMC · Pathfinder.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://sethaxen.github.io/Pathfinder.jl/examples/initializing-hmc/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Pathfinder.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../lib/public/">Public</a></li><li><a class="tocitem" href="../../lib/internals/">Internals</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../quickstart/">Quickstart</a></li><li class="is-active"><a class="tocitem" href>Initializing HMC</a><ul class="internal"><li><a class="tocitem" href="#The-MCMC-warm-up-phase"><span>The MCMC warm-up phase</span></a></li><li><a class="tocitem" href="#DynamicHMC.jl"><span>DynamicHMC.jl</span></a></li><li><a class="tocitem" href="#AdvancedHMC.jl"><span>AdvancedHMC.jl</span></a></li></ul></li><li><a class="tocitem" href="../turing/">Turing usage</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Initializing HMC</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Initializing HMC</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sethaxen/Pathfinder.jl/blob/master/docs/src/examples/initializing-hmc.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Initializing-HMC-with-Pathfinder"><a class="docs-heading-anchor" href="#Initializing-HMC-with-Pathfinder">Initializing HMC with Pathfinder</a><a id="Initializing-HMC-with-Pathfinder-1"></a><a class="docs-heading-anchor-permalink" href="#Initializing-HMC-with-Pathfinder" title="Permalink"></a></h1><h2 id="The-MCMC-warm-up-phase"><a class="docs-heading-anchor" href="#The-MCMC-warm-up-phase">The MCMC warm-up phase</a><a id="The-MCMC-warm-up-phase-1"></a><a class="docs-heading-anchor-permalink" href="#The-MCMC-warm-up-phase" title="Permalink"></a></h2><p>When using MCMC to draw samples from some target distribution, there is often a lengthy warm-up phase with 2 phases:</p><ol><li>converge to the <em>typical set</em> (the region of the target distribution where the bulk of the probability mass is located)</li><li>adapt any tunable parameters of the MCMC sampler (optional)</li></ol><p>While (1) often happens fairly quickly, (2) usually requires a lengthy exploration of the typical set to iteratively adapt parameters suitable for further exploration. An example is the widely used windowed adaptation scheme of Hamiltonian Monte Carlo (HMC) in Stan, where a step size and positive definite metric (aka mass matrix) are adapted.<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> For posteriors with complex geometry, the adaptation phase can require many evaluations of the gradient of the log density function of the target distribution.</p><p>Pathfinder can be used to initialize MCMC, and in particular HMC, in 3 ways:</p><ol><li>Initialize MCMC from one of Pathfinder&#39;s draws (replace phase 1 of the warm-up).</li><li>Initialize an HMC metric adaptation from the inverse of the covariance of the multivariate normal approximation (replace the first window of phase 2 of the warm-up).</li><li>Use the inverse of the covariance as the metric without further adaptation (replace phase 2 of the warm-up).</li></ol><p>This tutorial demonstrates all three approaches with <a href="https://tamaspapp.eu/DynamicHMC.jl/stable/">DynamicHMC.jl</a> and <a href="https://github.com/TuringLang/AdvancedHMC.jl">AdvancedHMC.jl</a>. Both of these packages have standalone implementations of adaptive HMC (aka NUTS) and can be used independently of any probabilistic programming language (PPL). Both the <a href="https://turing.ml/stable/">Turing</a> and <a href="https://github.com/cscherrer/Soss.jl">Soss</a> PPLs have some DynamicHMC integration, while Turing also integrates with AdvancedHMC.</p><p>For demonstration purposes, we&#39;ll use the following dummy data:</p><pre><code class="language-julia hljs">using LinearAlgebra, Pathfinder, Random, StatsFuns, StatsPlots

Random.seed!(91)

x = 0:0.01:1
y = @. sin(10x) + randn() * 0.2 + x

scatter(x, y; xlabel=&quot;x&quot;, ylabel=&quot;y&quot;, legend=false, msw=0, ms=2)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip810">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip810)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip811">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip810)" d="
M102.74 1505.26 L2352.76 1505.26 L2352.76 47.2441 L102.74 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip812">
    <rect x="102" y="47" width="2251" height="1459"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip812)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  166.42,1505.26 166.42,47.2441 
  "/>
<polyline clip-path="url(#clip812)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  697.084,1505.26 697.084,47.2441 
  "/>
<polyline clip-path="url(#clip812)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1227.75,1505.26 1227.75,47.2441 
  "/>
<polyline clip-path="url(#clip812)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1758.41,1505.26 1758.41,47.2441 
  "/>
<polyline clip-path="url(#clip812)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2289.08,1505.26 2289.08,47.2441 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1505.26 2352.76,1505.26 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  166.42,1505.26 166.42,1486.36 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  697.084,1505.26 697.084,1486.36 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1227.75,1505.26 1227.75,1486.36 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1758.41,1505.26 1758.41,1486.36 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2289.08,1505.26 2289.08,1486.36 
  "/>
<path clip-path="url(#clip810)" d="M128.723 1536.18 Q125.112 1536.18 123.284 1539.74 Q121.478 1543.28 121.478 1550.41 Q121.478 1557.52 123.284 1561.09 Q125.112 1564.63 128.723 1564.63 Q132.358 1564.63 134.163 1561.09 Q135.992 1557.52 135.992 1550.41 Q135.992 1543.28 134.163 1539.74 Q132.358 1536.18 128.723 1536.18 M128.723 1532.47 Q134.533 1532.47 137.589 1537.08 Q140.668 1541.66 140.668 1550.41 Q140.668 1559.14 137.589 1563.75 Q134.533 1568.33 128.723 1568.33 Q122.913 1568.33 119.834 1563.75 Q116.779 1559.14 116.779 1550.41 Q116.779 1541.66 119.834 1537.08 Q122.913 1532.47 128.723 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M148.885 1561.78 L153.769 1561.78 L153.769 1567.66 L148.885 1567.66 L148.885 1561.78 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M173.955 1536.18 Q170.343 1536.18 168.515 1539.74 Q166.709 1543.28 166.709 1550.41 Q166.709 1557.52 168.515 1561.09 Q170.343 1564.63 173.955 1564.63 Q177.589 1564.63 179.394 1561.09 Q181.223 1557.52 181.223 1550.41 Q181.223 1543.28 179.394 1539.74 Q177.589 1536.18 173.955 1536.18 M173.955 1532.47 Q179.765 1532.47 182.82 1537.08 Q185.899 1541.66 185.899 1550.41 Q185.899 1559.14 182.82 1563.75 Q179.765 1568.33 173.955 1568.33 Q168.144 1568.33 165.066 1563.75 Q162.01 1559.14 162.01 1550.41 Q162.01 1541.66 165.066 1537.08 Q168.144 1532.47 173.955 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M204.116 1536.18 Q200.505 1536.18 198.677 1539.74 Q196.871 1543.28 196.871 1550.41 Q196.871 1557.52 198.677 1561.09 Q200.505 1564.63 204.116 1564.63 Q207.751 1564.63 209.556 1561.09 Q211.385 1557.52 211.385 1550.41 Q211.385 1543.28 209.556 1539.74 Q207.751 1536.18 204.116 1536.18 M204.116 1532.47 Q209.927 1532.47 212.982 1537.08 Q216.061 1541.66 216.061 1550.41 Q216.061 1559.14 212.982 1563.75 Q209.927 1568.33 204.116 1568.33 Q198.306 1568.33 195.228 1563.75 Q192.172 1559.14 192.172 1550.41 Q192.172 1541.66 195.228 1537.08 Q198.306 1532.47 204.116 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M659.885 1536.18 Q656.274 1536.18 654.445 1539.74 Q652.64 1543.28 652.64 1550.41 Q652.64 1557.52 654.445 1561.09 Q656.274 1564.63 659.885 1564.63 Q663.519 1564.63 665.325 1561.09 Q667.154 1557.52 667.154 1550.41 Q667.154 1543.28 665.325 1539.74 Q663.519 1536.18 659.885 1536.18 M659.885 1532.47 Q665.695 1532.47 668.751 1537.08 Q671.829 1541.66 671.829 1550.41 Q671.829 1559.14 668.751 1563.75 Q665.695 1568.33 659.885 1568.33 Q654.075 1568.33 650.996 1563.75 Q647.941 1559.14 647.941 1550.41 Q647.941 1541.66 650.996 1537.08 Q654.075 1532.47 659.885 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M680.047 1561.78 L684.931 1561.78 L684.931 1567.66 L680.047 1567.66 L680.047 1561.78 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M699.144 1563.72 L715.463 1563.72 L715.463 1567.66 L693.519 1567.66 L693.519 1563.72 Q696.181 1560.97 700.764 1556.34 Q705.371 1551.69 706.551 1550.35 Q708.797 1547.82 709.676 1546.09 Q710.579 1544.33 710.579 1542.64 Q710.579 1539.88 708.635 1538.15 Q706.714 1536.41 703.612 1536.41 Q701.413 1536.41 698.959 1537.17 Q696.528 1537.94 693.751 1539.49 L693.751 1534.77 Q696.575 1533.63 699.028 1533.05 Q701.482 1532.47 703.519 1532.47 Q708.889 1532.47 712.084 1535.16 Q715.278 1537.85 715.278 1542.34 Q715.278 1544.47 714.468 1546.39 Q713.681 1548.28 711.575 1550.88 Q710.996 1551.55 707.894 1554.77 Q704.792 1557.96 699.144 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M725.325 1533.1 L743.681 1533.1 L743.681 1537.04 L729.607 1537.04 L729.607 1545.51 Q730.625 1545.16 731.644 1545 Q732.662 1544.81 733.681 1544.81 Q739.468 1544.81 742.848 1547.98 Q746.227 1551.16 746.227 1556.57 Q746.227 1562.15 742.755 1565.25 Q739.283 1568.33 732.963 1568.33 Q730.787 1568.33 728.519 1567.96 Q726.274 1567.59 723.866 1566.85 L723.866 1562.15 Q725.95 1563.28 728.172 1563.84 Q730.394 1564.4 732.871 1564.4 Q736.875 1564.4 739.213 1562.29 Q741.551 1560.18 741.551 1556.57 Q741.551 1552.96 739.213 1550.85 Q736.875 1548.75 732.871 1548.75 Q730.996 1548.75 729.121 1549.16 Q727.269 1549.58 725.325 1550.46 L725.325 1533.1 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M1190.05 1536.18 Q1186.44 1536.18 1184.61 1539.74 Q1182.81 1543.28 1182.81 1550.41 Q1182.81 1557.52 1184.61 1561.09 Q1186.44 1564.63 1190.05 1564.63 Q1193.69 1564.63 1195.49 1561.09 Q1197.32 1557.52 1197.32 1550.41 Q1197.32 1543.28 1195.49 1539.74 Q1193.69 1536.18 1190.05 1536.18 M1190.05 1532.47 Q1195.86 1532.47 1198.92 1537.08 Q1202 1541.66 1202 1550.41 Q1202 1559.14 1198.92 1563.75 Q1195.86 1568.33 1190.05 1568.33 Q1184.24 1568.33 1181.16 1563.75 Q1178.11 1559.14 1178.11 1550.41 Q1178.11 1541.66 1181.16 1537.08 Q1184.24 1532.47 1190.05 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M1210.21 1561.78 L1215.1 1561.78 L1215.1 1567.66 L1210.21 1567.66 L1210.21 1561.78 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M1225.33 1533.1 L1243.69 1533.1 L1243.69 1537.04 L1229.61 1537.04 L1229.61 1545.51 Q1230.63 1545.16 1231.65 1545 Q1232.67 1544.81 1233.69 1544.81 Q1239.47 1544.81 1242.85 1547.98 Q1246.23 1551.16 1246.23 1556.57 Q1246.23 1562.15 1242.76 1565.25 Q1239.29 1568.33 1232.97 1568.33 Q1230.79 1568.33 1228.52 1567.96 Q1226.28 1567.59 1223.87 1566.85 L1223.87 1562.15 Q1225.95 1563.28 1228.18 1563.84 Q1230.4 1564.4 1232.88 1564.4 Q1236.88 1564.4 1239.22 1562.29 Q1241.56 1560.18 1241.56 1556.57 Q1241.56 1552.96 1239.22 1550.85 Q1236.88 1548.75 1232.88 1548.75 Q1231 1548.75 1229.13 1549.16 Q1227.27 1549.58 1225.33 1550.46 L1225.33 1533.1 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M1265.44 1536.18 Q1261.83 1536.18 1260 1539.74 Q1258.2 1543.28 1258.2 1550.41 Q1258.2 1557.52 1260 1561.09 Q1261.83 1564.63 1265.44 1564.63 Q1269.08 1564.63 1270.88 1561.09 Q1272.71 1557.52 1272.71 1550.41 Q1272.71 1543.28 1270.88 1539.74 Q1269.08 1536.18 1265.44 1536.18 M1265.44 1532.47 Q1271.25 1532.47 1274.31 1537.08 Q1277.39 1541.66 1277.39 1550.41 Q1277.39 1559.14 1274.31 1563.75 Q1271.25 1568.33 1265.44 1568.33 Q1259.63 1568.33 1256.56 1563.75 Q1253.5 1559.14 1253.5 1550.41 Q1253.5 1541.66 1256.56 1537.08 Q1259.63 1532.47 1265.44 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M1721.21 1536.18 Q1717.6 1536.18 1715.77 1539.74 Q1713.97 1543.28 1713.97 1550.41 Q1713.97 1557.52 1715.77 1561.09 Q1717.6 1564.63 1721.21 1564.63 Q1724.85 1564.63 1726.65 1561.09 Q1728.48 1557.52 1728.48 1550.41 Q1728.48 1543.28 1726.65 1539.74 Q1724.85 1536.18 1721.21 1536.18 M1721.21 1532.47 Q1727.02 1532.47 1730.08 1537.08 Q1733.16 1541.66 1733.16 1550.41 Q1733.16 1559.14 1730.08 1563.75 Q1727.02 1568.33 1721.21 1568.33 Q1715.4 1568.33 1712.32 1563.75 Q1709.27 1559.14 1709.27 1550.41 Q1709.27 1541.66 1712.32 1537.08 Q1715.4 1532.47 1721.21 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M1741.38 1561.78 L1746.26 1561.78 L1746.26 1567.66 L1741.38 1567.66 L1741.38 1561.78 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M1755.26 1533.1 L1777.49 1533.1 L1777.49 1535.09 L1764.94 1567.66 L1760.06 1567.66 L1771.86 1537.04 L1755.26 1537.04 L1755.26 1533.1 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M1786.65 1533.1 L1805.01 1533.1 L1805.01 1537.04 L1790.94 1537.04 L1790.94 1545.51 Q1791.95 1545.16 1792.97 1545 Q1793.99 1544.81 1795.01 1544.81 Q1800.8 1544.81 1804.18 1547.98 Q1807.56 1551.16 1807.56 1556.57 Q1807.56 1562.15 1804.08 1565.25 Q1800.61 1568.33 1794.29 1568.33 Q1792.12 1568.33 1789.85 1567.96 Q1787.6 1567.59 1785.19 1566.85 L1785.19 1562.15 Q1787.28 1563.28 1789.5 1563.84 Q1791.72 1564.4 1794.2 1564.4 Q1798.2 1564.4 1800.54 1562.29 Q1802.88 1560.18 1802.88 1556.57 Q1802.88 1552.96 1800.54 1550.85 Q1798.2 1548.75 1794.2 1548.75 Q1792.32 1548.75 1790.45 1549.16 Q1788.6 1549.58 1786.65 1550.46 L1786.65 1533.1 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M2241.15 1563.72 L2248.79 1563.72 L2248.79 1537.36 L2240.48 1539.03 L2240.48 1534.77 L2248.74 1533.1 L2253.42 1533.1 L2253.42 1563.72 L2261.06 1563.72 L2261.06 1567.66 L2241.15 1567.66 L2241.15 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M2270.5 1561.78 L2275.38 1561.78 L2275.38 1567.66 L2270.5 1567.66 L2270.5 1561.78 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M2295.57 1536.18 Q2291.96 1536.18 2290.13 1539.74 Q2288.32 1543.28 2288.32 1550.41 Q2288.32 1557.52 2290.13 1561.09 Q2291.96 1564.63 2295.57 1564.63 Q2299.2 1564.63 2301.01 1561.09 Q2302.84 1557.52 2302.84 1550.41 Q2302.84 1543.28 2301.01 1539.74 Q2299.2 1536.18 2295.57 1536.18 M2295.57 1532.47 Q2301.38 1532.47 2304.43 1537.08 Q2307.51 1541.66 2307.51 1550.41 Q2307.51 1559.14 2304.43 1563.75 Q2301.38 1568.33 2295.57 1568.33 Q2289.76 1568.33 2286.68 1563.75 Q2283.62 1559.14 2283.62 1550.41 Q2283.62 1541.66 2286.68 1537.08 Q2289.76 1532.47 2295.57 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M2325.73 1536.18 Q2322.12 1536.18 2320.29 1539.74 Q2318.49 1543.28 2318.49 1550.41 Q2318.49 1557.52 2320.29 1561.09 Q2322.12 1564.63 2325.73 1564.63 Q2329.37 1564.63 2331.17 1561.09 Q2333 1557.52 2333 1550.41 Q2333 1543.28 2331.17 1539.74 Q2329.37 1536.18 2325.73 1536.18 M2325.73 1532.47 Q2331.54 1532.47 2334.6 1537.08 Q2337.68 1541.66 2337.68 1550.41 Q2337.68 1559.14 2334.6 1563.75 Q2331.54 1568.33 2325.73 1568.33 Q2319.92 1568.33 2316.84 1563.75 Q2313.79 1559.14 2313.79 1550.41 Q2313.79 1541.66 2316.84 1537.08 Q2319.92 1532.47 2325.73 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M1244.36 1614.48 L1231.47 1631.82 L1245.03 1650.12 L1238.12 1650.12 L1227.75 1636.12 L1217.37 1650.12 L1210.47 1650.12 L1224.31 1631.47 L1211.64 1614.48 L1218.55 1614.48 L1228 1627.18 L1237.46 1614.48 L1244.36 1614.48 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip812)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  102.74,1484.89 2352.76,1484.89 
  "/>
<polyline clip-path="url(#clip812)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  102.74,1016.66 2352.76,1016.66 
  "/>
<polyline clip-path="url(#clip812)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  102.74,548.425 2352.76,548.425 
  "/>
<polyline clip-path="url(#clip812)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  102.74,80.1921 2352.76,80.1921 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1505.26 102.74,47.2441 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1484.89 121.638,1484.89 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1016.66 121.638,1016.66 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,548.425 121.638,548.425 
  "/>
<polyline clip-path="url(#clip810)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,80.1921 121.638,80.1921 
  "/>
<path clip-path="url(#clip810)" d="M6.25437 1485.34 L35.9301 1485.34 L35.9301 1489.28 L6.25437 1489.28 L6.25437 1485.34 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M46.8329 1498.24 L54.4717 1498.24 L54.4717 1471.87 L46.1616 1473.54 L46.1616 1469.28 L54.4254 1467.61 L59.1013 1467.61 L59.1013 1498.24 L66.7402 1498.24 L66.7402 1502.17 L46.8329 1502.17 L46.8329 1498.24 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M54.7958 1002.46 Q51.1847 1002.46 49.356 1006.02 Q47.5504 1009.56 47.5504 1016.69 Q47.5504 1023.8 49.356 1027.36 Q51.1847 1030.91 54.7958 1030.91 Q58.43 1030.91 60.2356 1027.36 Q62.0643 1023.8 62.0643 1016.69 Q62.0643 1009.56 60.2356 1006.02 Q58.43 1002.46 54.7958 1002.46 M54.7958 998.753 Q60.6059 998.753 63.6615 1003.36 Q66.7402 1007.94 66.7402 1016.69 Q66.7402 1025.42 63.6615 1030.03 Q60.6059 1034.61 54.7958 1034.61 Q48.9856 1034.61 45.9069 1030.03 Q42.8514 1025.42 42.8514 1016.69 Q42.8514 1007.94 45.9069 1003.36 Q48.9856 998.753 54.7958 998.753 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M46.8329 561.77 L54.4717 561.77 L54.4717 535.404 L46.1616 537.071 L46.1616 532.812 L54.4254 531.145 L59.1013 531.145 L59.1013 561.77 L66.7402 561.77 L66.7402 565.705 L46.8329 565.705 L46.8329 561.77 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M50.4208 93.5369 L66.7402 93.5369 L66.7402 97.4721 L44.7958 97.4721 L44.7958 93.5369 Q47.4579 90.7823 52.0412 86.1527 Q56.6476 81.4999 57.8282 80.1573 Q60.0735 77.6342 60.9532 75.8981 Q61.8559 74.1388 61.8559 72.449 Q61.8559 69.6944 59.9115 67.9583 Q57.9902 66.2222 54.8884 66.2222 Q52.6893 66.2222 50.2356 66.9861 Q47.8051 67.75 45.0273 69.3009 L45.0273 64.5787 Q47.8514 63.4445 50.3051 62.8658 Q52.7588 62.2871 54.7958 62.2871 Q60.1661 62.2871 63.3605 64.9722 Q66.555 67.6574 66.555 72.1481 Q66.555 74.2777 65.7448 76.199 Q64.9578 78.0972 62.8513 80.6897 Q62.2726 81.361 59.1708 84.5786 Q56.0689 87.773 50.4208 93.5369 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip810)" d="M-40.6915 774.565 Q-34.3258 777.048 -32.3842 779.403 Q-30.4427 781.758 -30.4427 785.705 L-30.4427 790.384 L-35.3443 790.384 L-35.3443 786.946 Q-35.3443 784.527 -36.4901 783.191 Q-37.6359 781.854 -41.9009 780.231 L-44.5745 779.18 L-79.6496 793.599 L-79.6496 787.392 L-51.7678 776.252 L-79.6496 765.112 L-79.6496 758.905 L-40.6915 774.565 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><circle clip-path="url(#clip812)" cx="166.42" cy="910.805" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="187.646" cy="1003.36" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="208.873" cy="850.56" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="230.1" cy="792.901" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="251.326" cy="718.268" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="272.553" cy="856.52" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="293.779" cy="711.192" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="315.006" cy="737.994" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="336.232" cy="476.265" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="357.459" cy="579.393" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="378.685" cy="632.409" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="399.912" cy="755.897" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="421.139" cy="494.625" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="442.365" cy="468.224" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="463.592" cy="458.514" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="484.818" cy="584.713" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="506.045" cy="463.394" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="527.271" cy="478.871" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="548.498" cy="534.839" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="569.725" cy="528.641" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="590.951" cy="610.097" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="612.178" cy="497.263" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="633.404" cy="715.45" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="654.631" cy="475.561" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="675.857" cy="580.029" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="697.084" cy="572.947" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="718.311" cy="693.371" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="739.537" cy="838.929" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="760.764" cy="763.909" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="781.99" cy="752.612" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="803.217" cy="728.766" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="824.443" cy="649.092" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="845.67" cy="926.315" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="866.896" cy="1044" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="888.123" cy="968.869" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="909.35" cy="891.046" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="930.576" cy="1061.7" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="951.803" cy="939.16" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="973.029" cy="871.066" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="994.256" cy="1388.79" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1015.48" cy="1198.61" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1036.71" cy="1398.61" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1057.94" cy="1128.36" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1079.16" cy="1249.02" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1100.39" cy="1291.6" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1121.62" cy="1255.38" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1142.84" cy="1464" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1164.07" cy="1336.46" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1185.29" cy="1416.54" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1206.52" cy="1175.34" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1227.75" cy="1269.34" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1248.97" cy="1290.95" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1270.2" cy="1164.82" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1291.43" cy="1057.84" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1312.65" cy="1380.21" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1333.88" cy="1100.11" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1355.11" cy="1155.6" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1376.33" cy="1040.57" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1397.56" cy="999.495" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1418.79" cy="992.964" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1440.01" cy="887.573" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1461.24" cy="812.735" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1482.47" cy="744.256" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1503.69" cy="786.023" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1524.92" cy="586.098" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1546.15" cy="580.123" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1567.37" cy="507.562" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1588.6" cy="455.868" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1609.83" cy="414.433" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1631.05" cy="427.607" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1652.28" cy="459.752" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1673.51" cy="534.95" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1694.73" cy="364.156" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1715.96" cy="203.481" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1737.19" cy="300.81" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1758.41" cy="308.632" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1779.64" cy="97.5471" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1800.87" cy="363.674" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1822.09" cy="207.439" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1843.32" cy="88.5087" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1864.54" cy="143.039" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1885.77" cy="298.307" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1907" cy="96.5504" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1928.22" cy="187.407" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1949.45" cy="309.753" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1970.68" cy="174.321" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="1991.9" cy="299.979" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2013.13" cy="361.531" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2034.36" cy="236.142" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2055.58" cy="339.164" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2076.81" cy="425.088" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2098.04" cy="554.444" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2119.26" cy="507.674" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2140.49" cy="606.365" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2161.72" cy="394.726" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2182.94" cy="625.305" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2204.17" cy="458.686" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2225.4" cy="851.548" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2246.62" cy="822.39" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2267.85" cy="771.609" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip812)" cx="2289.08" cy="689.831" r="7" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
</svg>
<p>We&#39;ll fit this using a simple polynomial regression model:</p><p class="math-container">\[\begin{aligned}
\sigma &amp;\sim \text{Half-Normal}(\mu=0, \sigma=1)\\
\alpha, \beta_j &amp;\sim \mathrm{Normal}(\mu=0, \sigma=1)\\
\hat{y}_i &amp;= \alpha + \sum_{j=1}^J x_i^j \beta_j\\
y_i &amp;\sim \mathrm{Normal}(\mu=\hat{y}_i, \sigma=\sigma)
\end{aligned}\]</p><p>We just need to implement the log-density function of the resulting posterior.</p><pre><code class="language-julia hljs">struct RegressionProblem{X,Z,Y}
    x::X
    J::Int
    z::Z
    y::Y
end
function RegressionProblem(x, J, y)
    z = x .* (1:J)&#39;
    return RegressionProblem(x, J, z, y)
end

function (prob::RegressionProblem)(θ)
    σ = θ.σ
    α = θ.α
    β = θ.β
    z = prob.z
    y = prob.y
    lp = normlogpdf(σ) + logtwo
    lp += normlogpdf(α)
    lp += sum(normlogpdf, β)
    y_hat = muladd(z, β, α)
    lp += sum(eachindex(y_hat, y)) do i
        return normlogpdf(y_hat[i], σ, y[i])
    end
    return lp
end

J = 3
dim = J + 2
model = RegressionProblem(x, J, y)
ndraws = 1_000;</code></pre><h2 id="DynamicHMC.jl"><a class="docs-heading-anchor" href="#DynamicHMC.jl">DynamicHMC.jl</a><a id="DynamicHMC.jl-1"></a><a class="docs-heading-anchor-permalink" href="#DynamicHMC.jl" title="Permalink"></a></h2><p>To use DynamicHMC, we first need to transform our model to an unconstrained space using <a href="https://tamaspapp.eu/TransformVariables.jl/stable/">TransformVariables.jl</a> and wrap it in a type that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface:</p><pre><code class="language-julia hljs">using DynamicHMC, LogDensityProblems, TransformVariables

transform = as((σ=asℝ₊, α=asℝ, β=as(Array, J)))
P = TransformedLogDensity(transform, model)
∇P = ADgradient(:ForwardDiff, P)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ForwardDiff AD wrapper for TransformedLogDensity of dimension 5, w/ chunk size 5</code></pre><p>Pathfinder, on the other hand, expects a log-density function:</p><pre><code class="language-julia hljs">logp(x) = LogDensityProblems.logdensity(P, x)
∇logp(x) = LogDensityProblems.logdensity_and_gradient(∇P, x)[2]
result_pf = pathfinder(logp, ∇logp; dim)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Single-path Pathfinder result
  tries: 2
  draws: 5
  fit iteration: 22 (total: 30)
  fit ELBO: -117.74 ± 0.25
  fit distribution: Distributions.MvNormal{Float64, Pathfinder.WoodburyPDMat{Float64, LinearAlgebra.Diagonal{Float64, Vector{Float64}}, Matrix{Float64}, Matrix{Float64}, LinearAlgebra.Diagonal{Float64, Vector{Float64}}, LinearAlgebra.QRCompactWYQ{Float64, Matrix{Float64}}, LinearAlgebra.UpperTriangular{Float64, Matrix{Float64}}}, Vector{Float64}}(
dim: 5
μ: [-0.351938851773518, 0.24689540392550613, 0.05827742217490308, 0.11655069217591063, 0.17482994194820867]
Σ: [0.005794060117888708 0.004501772414217777 … 0.005154335534465927 -0.004280279761853394; 0.004501772414217777 0.03531824833492471 … 0.007991672055998154 -0.017293830014585607; … ; 0.005154335534465927 0.007991672055998154 … 0.7015097471184754 -0.440833068526388; -0.004280279761853394 -0.017293830014585607 … -0.440833068526388 0.28326699991508697]
)
</code></pre><pre><code class="language-julia hljs">init_params = result_pf.draws[:, 1]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 -0.3490992268968827
  0.1768169119835949
  0.1570690692732149
 -0.25930709446876066
  0.4601383974449641</code></pre><pre><code class="language-julia hljs">inv_metric = result_pf.fit_distribution.Σ</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×5 Pathfinder.WoodburyPDMat{Float64, LinearAlgebra.Diagonal{Float64, Vector{Float64}}, Matrix{Float64}, Matrix{Float64}, LinearAlgebra.Diagonal{Float64, Vector{Float64}}, LinearAlgebra.QRCompactWYQ{Float64, Matrix{Float64}}, LinearAlgebra.UpperTriangular{Float64, Matrix{Float64}}}:
  0.00579406   0.00450177  -0.00167075   0.00515434  -0.00428028
  0.00450177   0.0353182   -0.00747888   0.00799167  -0.0172938
 -0.00167075  -0.00747888   0.0168776   -0.0892416    0.0570341
  0.00515434   0.00799167  -0.0892416    0.70151     -0.440833
 -0.00428028  -0.0172938    0.0570341   -0.440833     0.283267</code></pre><h3 id="Initializing-from-Pathfinder&#39;s-draws"><a class="docs-heading-anchor" href="#Initializing-from-Pathfinder&#39;s-draws">Initializing from Pathfinder&#39;s draws</a><a id="Initializing-from-Pathfinder&#39;s-draws-1"></a><a class="docs-heading-anchor-permalink" href="#Initializing-from-Pathfinder&#39;s-draws" title="Permalink"></a></h3><p>Here we just need to pass one of the draws as the initial point <code>q</code>:</p><pre><code class="language-julia hljs">result_dhmc1 = mcmc_with_warmup(
    Random.GLOBAL_RNG,
    ∇P,
    ndraws;
    initialization=(; q=init_params),
    reporter=NoProgressReport(),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(chain = [[-0.3054824878530329, 0.26716149034039127, 0.7272689968468079, 0.2224486380659594, -0.1084255831324917], [-0.2908467858510639, 0.19167155361676114, 1.1406365409260684, 0.14758964884858555, -0.1893670281139442], [-0.34380945343229175, 0.29942215184083626, -0.5777824599114699, -0.6436287965429913, 0.8855090720222333], [-0.3841685466201196, 0.298174614226367, -0.8075365335489764, -0.8012813635146329, 1.0430495860586186], [-0.3078946717468547, 0.1449226032162257, 0.966474834432309, 1.1756039883046019, -0.7675640485149511], [-0.4098788448240356, 0.2800277635593168, 1.1373781866199255, 0.8297890464051306, -0.6656931424880262], [-0.28296609351271146, 0.1399317686644654, -0.6466329049508028, -0.48956010944986833, 0.8480265722438117], [-0.3484255190604426, 0.4504492370598197, -0.6315922138596126, -0.4015110802255826, 0.6332081316466722], [-0.3747347856309989, 0.5472993824076655, -0.37225248010847106, 0.1024349049883511, 0.15244430259053593], [-0.3300313853900508, 0.46284215429419595, 0.1874576267346407, 1.3378385817088472, -0.8083618954078022]  …  [-0.31072635481228855, 0.20843508356383786, -0.29619040772947697, 0.1594231315281357, 0.24332667433800123], [-0.39974129011056325, 0.3637468122811537, 0.4933883462994535, -0.3787207012871011, 0.2651944597766067], [-0.3542558369945796, 0.1495449158925911, 0.8517267638270553, 0.2785576452489584, -0.17457112429855806], [-0.1853801381895988, 0.23896740322195176, 0.22996644753240914, 0.45103705737965505, -0.12854476831105335], [-0.3402471311415508, 0.20837227343479497, 0.6997160004775824, -0.3685188026143038, 0.295033514448492], [-0.4078770616352019, 0.22757752082219623, 0.9679549801607268, 0.07750776502403585, -0.058761358208542516], [-0.2361153382432716, 0.02967011762316478, -0.9934006020057146, 1.0904793194213718, -0.0063575051995702694], [-0.49946058746542576, 0.31720230291547447, -1.2365164441760672, 1.4512891585712568, -0.2873856503848051], [-0.21479342697125292, 0.3856930954891587, -1.242743645322185, 0.7083792209059254, 0.18000632998117008], [-0.1523994901923122, 0.38159343778183635, -1.0682894335107957, 0.8244042197978011, 0.05364026627825244]], tree_statistics = DynamicHMC.TreeStatisticsNUTS[DynamicHMC.TreeStatisticsNUTS(-114.15400794126327, 6, turning at positions -19:44, 0.9492141091360732, 63, DynamicHMC.Directions(0xee0eb5ac)), DynamicHMC.TreeStatisticsNUTS(-116.9178695617601, 4, turning at positions -18:-21, 0.6815805736349873, 27, DynamicHMC.Directions(0x5a830266)), DynamicHMC.TreeStatisticsNUTS(-115.18440484050973, 6, turning at positions -63:-126, 0.9116318507184775, 127, DynamicHMC.Directions(0xdbb78201)), DynamicHMC.TreeStatisticsNUTS(-113.81474776521897, 5, turning at positions -23:8, 0.956538594557927, 31, DynamicHMC.Directions(0x032d8048)), DynamicHMC.TreeStatisticsNUTS(-115.75368493826885, 6, turning at positions -3:-66, 0.8388534632122178, 127, DynamicHMC.Directions(0x935ed1bd)), DynamicHMC.TreeStatisticsNUTS(-115.09668319549168, 6, turning at positions -16:47, 0.9597687648205017, 63, DynamicHMC.Directions(0x7307faaf)), DynamicHMC.TreeStatisticsNUTS(-114.80717267223568, 6, turning at positions -64:-127, 0.9551766204635971, 127, DynamicHMC.Directions(0xc3191b00)), DynamicHMC.TreeStatisticsNUTS(-114.90288512307714, 6, turning at positions -7:56, 0.9996478269889557, 63, DynamicHMC.Directions(0x7d7ef1f8)), DynamicHMC.TreeStatisticsNUTS(-115.91286730747049, 6, turning at positions 17:80, 0.9720161691638178, 127, DynamicHMC.Directions(0x0bf12850)), DynamicHMC.TreeStatisticsNUTS(-117.94794296381068, 6, turning at positions 44:75, 0.998250584541677, 127, DynamicHMC.Directions(0x43578b4b))  …  DynamicHMC.TreeStatisticsNUTS(-115.84642406135495, 6, turning at positions -3:60, 0.9991160380944365, 63, DynamicHMC.Directions(0x9e66917c)), DynamicHMC.TreeStatisticsNUTS(-113.73726930521377, 6, turning at positions -12:51, 0.9986240203269211, 63, DynamicHMC.Directions(0x9b931c33)), DynamicHMC.TreeStatisticsNUTS(-114.23850648162878, 6, turning at positions 44:107, 0.9999464446902606, 127, DynamicHMC.Directions(0x6f8cfeeb)), DynamicHMC.TreeStatisticsNUTS(-115.46375345569334, 6, turning at positions -42:21, 0.9985708208150224, 63, DynamicHMC.Directions(0xe3e72615)), DynamicHMC.TreeStatisticsNUTS(-116.01823423987909, 5, turning at positions 26:57, 0.9745804428838801, 63, DynamicHMC.Directions(0x3ecbc779)), DynamicHMC.TreeStatisticsNUTS(-114.69696701473379, 6, turning at positions -39:24, 0.9233080673302962, 63, DynamicHMC.Directions(0x441e7cd8)), DynamicHMC.TreeStatisticsNUTS(-117.35150530514632, 6, turning at positions -10:53, 0.8365132628991666, 63, DynamicHMC.Directions(0x6e0175b5)), DynamicHMC.TreeStatisticsNUTS(-120.4341963577804, 6, turning at positions -58:5, 0.7807080851860081, 63, DynamicHMC.Directions(0x56aeefc5)), DynamicHMC.TreeStatisticsNUTS(-119.26952539421957, 6, turning at positions -19:44, 0.9175398948981508, 63, DynamicHMC.Directions(0x7fb8ddec)), DynamicHMC.TreeStatisticsNUTS(-117.71739151900293, 5, turning at positions -16:15, 0.9749333614771457, 31, DynamicHMC.Directions(0x14e6300f))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.09863365582929956, 0.15308261911791746, 0.9057803227265346, 0.8931366390391907, 0.634247594940043], ϵ = 0.0464756012812803)</code></pre><h3 id="Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate"><a class="docs-heading-anchor" href="#Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate">Initializing metric adaptation from Pathfinder&#39;s estimate</a><a id="Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate-1"></a><a class="docs-heading-anchor-permalink" href="#Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate" title="Permalink"></a></h3><p>To start with Pathfinder&#39;s inverse metric estimate, we just need to initialize a <code>GaussianKineticEnergy</code> object with it as input: </p><pre><code class="language-julia hljs">result_dhmc2 = mcmc_with_warmup(
    Random.GLOBAL_RNG,
    ∇P,
    ndraws;
    initialization=(; q=init_params, κ=GaussianKineticEnergy(inv_metric)),
    warmup_stages=default_warmup_stages(; M=Symmetric),
    reporter=NoProgressReport(),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(chain = [[-0.3478555505666078, 0.28566963155258573, -0.3039860088471689, 1.0425348049494092, -0.3555308301304248], [-0.22185683663029232, 0.44987978175707327, 0.17865687722681858, 1.0721116385526155, -0.5998436908188697], [-0.4275627363034338, 0.14361683914845055, 1.0320557673162785, -0.5048875866654339, 0.3501546588520045], [-0.2702456386599849, 0.28441573303010637, -0.002696094146027894, -0.20402445336139563, 0.41357314219644126], [-0.2833595965939425, 0.0256630656375383, 0.637017086177275, -0.1820050432502558, 0.2514059608015887], [-0.28450497537571884, -0.011201377561718268, 0.6513942878393733, -1.581147009528575, 1.154528478463449], [-0.34719030641982745, 0.2643791617092923, -0.8771094859690602, 1.5835610150372124, -0.5166235869220701], [-0.35058282723605494, 0.2286480070972828, -0.954637566789732, 1.789968185865786, -0.6294809876579271], [-0.41922096664709696, 0.19548109878737857, -1.0188112056666514, 2.391484777332231, -0.9206766463689573], [-0.2623956652254095, 0.20747937136437108, 0.9066782684739545, 0.21293831301331612, -0.19005037646996936]  …  [-0.351329200130322, 0.4950808684205919, -0.3450549437791801, -0.5184460617820648, 0.6807383600006882], [-0.3079484725656924, 0.13787429032188514, -0.034651750606338155, 1.0633190795946417, -0.2841506919613282], [-0.4469767109078189, 0.29601977173316024, -0.4279501361966277, -0.23624817279527655, 0.4806349694374962], [-0.2226204917329171, 0.2512990850188788, 0.425832777587661, 1.4181425346176357, -0.8763536203553558], [-0.506825748619421, 0.21233175252574596, 0.41136652790129813, -0.5755032609483511, 0.492315082816813], [-0.22534637054262452, 0.0642804391235076, 1.7220568095136728, 1.036653925426104, -0.9059821645089774], [-0.5414696999799251, 0.37185070137131065, 0.30343988977766123, 0.6461351430637023, -0.3193459633453238], [-0.1998841270604209, 0.3213693693117637, 0.04306330123728934, -0.8670242380920774, 0.7173226312203658], [-0.26858461045785176, 0.048366934836505004, 0.6174936813509027, -0.1408390698225323, 0.2602191875391492], [-0.4028089613408873, 0.2604766866705982, 1.9695852026938778, 0.23330230475946687, -0.5728869638597195]], tree_statistics = DynamicHMC.TreeStatisticsNUTS[DynamicHMC.TreeStatisticsNUTS(-118.56993104809891, 3, turning at positions -8:-15, 0.9711476230784627, 15, DynamicHMC.Directions(0x49cc5380)), DynamicHMC.TreeStatisticsNUTS(-115.62562402915223, 3, turning at positions -2:5, 0.9361573929581903, 7, DynamicHMC.Directions(0x57018535)), DynamicHMC.TreeStatisticsNUTS(-118.24500914422634, 4, turning at positions -5:10, 0.9339690341311649, 15, DynamicHMC.Directions(0xa567683a)), DynamicHMC.TreeStatisticsNUTS(-114.65982630093585, 3, turning at positions -1:6, 0.9998476500173276, 7, DynamicHMC.Directions(0xb24e0c7e)), DynamicHMC.TreeStatisticsNUTS(-116.22533062903369, 3, turning at positions 8:15, 0.8588765589715973, 15, DynamicHMC.Directions(0xf6e488ff)), DynamicHMC.TreeStatisticsNUTS(-121.74724173897434, 4, turning at positions -2:13, 0.7422045102800061, 15, DynamicHMC.Directions(0xd89bff6d)), DynamicHMC.TreeStatisticsNUTS(-120.93513267799209, 4, turning at positions -8:7, 0.8868079654721653, 15, DynamicHMC.Directions(0xee38b517)), DynamicHMC.TreeStatisticsNUTS(-114.87215632279755, 2, turning at positions -1:2, 0.9601844524852932, 3, DynamicHMC.Directions(0xc02e73ce)), DynamicHMC.TreeStatisticsNUTS(-117.31851866456596, 2, turning at positions -3:0, 0.955130816893394, 3, DynamicHMC.Directions(0xeba57e10)), DynamicHMC.TreeStatisticsNUTS(-118.20932600513287, 3, turning at positions -3:4, 0.9999999999999999, 7, DynamicHMC.Directions(0xf8c42e1c))  …  DynamicHMC.TreeStatisticsNUTS(-117.05744000809719, 3, turning at positions -5:2, 0.9443567252059699, 7, DynamicHMC.Directions(0x3fb2bb42)), DynamicHMC.TreeStatisticsNUTS(-116.44443878962747, 3, turning at positions 0:7, 0.9972231992278049, 7, DynamicHMC.Directions(0x09e6681f)), DynamicHMC.TreeStatisticsNUTS(-118.42888402614437, 4, turning at positions -13:-20, 0.9474502168687965, 23, DynamicHMC.Directions(0x91f1c863)), DynamicHMC.TreeStatisticsNUTS(-116.73421844206871, 3, turning at positions -6:1, 0.9999999999999999, 7, DynamicHMC.Directions(0x4963f4c9)), DynamicHMC.TreeStatisticsNUTS(-118.95146133463368, 3, turning at positions -2:5, 0.9692460510549324, 7, DynamicHMC.Directions(0x7121029d)), DynamicHMC.TreeStatisticsNUTS(-119.56225775502568, 3, turning at positions -7:0, 0.9555597764482696, 7, DynamicHMC.Directions(0x53deb340)), DynamicHMC.TreeStatisticsNUTS(-121.80877402366072, 3, turning at positions -3:4, 0.8707498553160775, 7, DynamicHMC.Directions(0xa562e52c)), DynamicHMC.TreeStatisticsNUTS(-120.70797896307177, 3, turning at positions 0:7, 0.7064837640449765, 7, DynamicHMC.Directions(0xff4e1b27)), DynamicHMC.TreeStatisticsNUTS(-119.92388382667359, 2, turning at positions 4:7, 0.8596857735724966, 7, DynamicHMC.Directions(0xee376217)), DynamicHMC.TreeStatisticsNUTS(-118.8729221334817, 3, turning at positions -6:1, 0.905660486828216, 7, DynamicHMC.Directions(0x55692ba1))], κ = Gaussian kinetic energy (Symmetric), √diag(M⁻¹): [0.10173204300119906, 0.16300048737347342, 0.8343790775645613, 0.8723728615869799, 0.6369961761293935], ϵ = 0.3600881646105259)</code></pre><p>We also specified that DynamicHMC should tune a dense <code>Symmetric</code> matrix. However, we could also have requested a <code>Diagonal</code> metric.</p><h3 id="Use-Pathfinder&#39;s-metric-estimate-for-sampling"><a class="docs-heading-anchor" href="#Use-Pathfinder&#39;s-metric-estimate-for-sampling">Use Pathfinder&#39;s metric estimate for sampling</a><a id="Use-Pathfinder&#39;s-metric-estimate-for-sampling-1"></a><a class="docs-heading-anchor-permalink" href="#Use-Pathfinder&#39;s-metric-estimate-for-sampling" title="Permalink"></a></h3><p>To turn off metric adaptation entirely and use Pathfinder&#39;s estimate, we just set the number and size of the metric adaptation windows to 0.</p><pre><code class="language-julia hljs">result_dhmc3 = mcmc_with_warmup(
    Random.GLOBAL_RNG,
    ∇P,
    ndraws;
    initialization=(; q=init_params, κ=GaussianKineticEnergy(inv_metric)),
    warmup_stages=default_warmup_stages(; middle_steps=0, doubling_stages=0),
    reporter=NoProgressReport(),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(chain = [[-0.39683387911064644, 0.21261091838036572, 1.649852267628158, 0.028639232283564575, -0.2737661987080747], [-0.3369522523644598, 0.15131180260475655, 1.6256337628924247, 0.23870110149759882, -0.3826465723834686], [-0.36399494531671595, 0.12185994187016666, 0.15823884113922107, -0.6159600696478875, 0.686541263624796], [-0.2973182044114633, 0.3145005024420015, 0.0342064811358615, -0.16226698628404101, 0.3707809369636861], [-0.3747852338280996, 0.2618889043932082, 0.06975746024772049, -0.7180316007480979, 0.6837658713782979], [-0.20422889189207089, 0.3388379979467472, -0.06632789357308183, 0.4527003480058096, -0.11224311939613996], [-0.46007989340043176, 0.24074469403675505, 0.09245729320311394, -1.7536907135685347, 1.4246137495993225], [-0.2955056710658137, 0.5619234575561873, 0.536890497816221, -1.4352332220963433, 0.8754079777148333], [-0.34048469357559685, 0.34510614513999066, 0.00032298501632761767, 1.5519254917816303, -0.7422465037732703], [-0.3072630537176072, 0.3586988661801939, -0.09820218513455373, 2.4269621055479083, -1.2936871507119925]  …  [-0.3961234071449033, 0.20440109043154747, -0.7931056721619909, -0.059771607882957434, 0.6343528985421092], [-0.4106178514589018, 0.1924418169474951, -0.2784891364608879, -0.10472516511391322, 0.5112245532366781], [-0.2928099883289504, 0.2982430373041121, -0.5317417647164664, 0.24631632580812018, 0.20828307694212692], [-0.3469737030050967, -0.01798720139879189, -0.704923523342237, 1.683078292867254, -0.595357816920409], [-0.3015537062383372, 0.301886629406356, -0.6998530489795854, 1.349298063231379, -0.4791961886938798], [-0.40676314352622406, 0.1796150756868471, -0.6084510739820705, 0.6622987529099778, 0.1008875871742474], [-0.4255346020480816, 0.14852596552786568, -0.6915540744441869, 1.5129334287397582, -0.40202440437542053], [-0.27777629587394775, 0.19419449479078726, -0.5644049543029475, 0.4739365290698788, 0.18924969681922502], [-0.3990290870379156, 0.16689571852963642, -0.46781746039975497, -0.17799619170222153, 0.588019623396568], [-0.31321042641131397, 0.3649251386635836, -0.4892824987894493, -0.6611111805728146, 0.7960637794147192]], tree_statistics = DynamicHMC.TreeStatisticsNUTS[DynamicHMC.TreeStatisticsNUTS(-114.5218219401649, 5, turning at positions -21:-28, 0.9349363604738509, 39, DynamicHMC.Directions(0xffa5db0b)), DynamicHMC.TreeStatisticsNUTS(-115.11964990543144, 2, turning at positions 3:6, 0.9497645076059891, 7, DynamicHMC.Directions(0xa87bbb06)), DynamicHMC.TreeStatisticsNUTS(-115.68496853978448, 5, turning at positions 6:9, 0.881556390035262, 39, DynamicHMC.Directions(0x5af6e2a1)), DynamicHMC.TreeStatisticsNUTS(-113.40533554303035, 2, turning at positions -2:-5, 0.983610763409562, 7, DynamicHMC.Directions(0xad135812)), DynamicHMC.TreeStatisticsNUTS(-114.10455392741449, 3, turning at positions -4:3, 0.9843420369512524, 7, DynamicHMC.Directions(0x837f30b3)), DynamicHMC.TreeStatisticsNUTS(-115.62335520147963, 3, turning at positions -3:4, 0.9354351228743182, 7, DynamicHMC.Directions(0xe14b241c)), DynamicHMC.TreeStatisticsNUTS(-119.14727283273962, 3, turning at positions -4:3, 0.9230801676524945, 7, DynamicHMC.Directions(0xac5fa86b)), DynamicHMC.TreeStatisticsNUTS(-120.0426252436489, 4, turning at positions -24:-27, 0.8938586427111181, 31, DynamicHMC.Directions(0xb2970dc4)), DynamicHMC.TreeStatisticsNUTS(-118.8049452697508, 4, turning at positions -5:-12, 0.9487082096123871, 23, DynamicHMC.Directions(0x6e71932b)), DynamicHMC.TreeStatisticsNUTS(-118.79699921960899, 2, turning at positions -1:2, 0.9028367258297801, 3, DynamicHMC.Directions(0x8797ce12))  …  DynamicHMC.TreeStatisticsNUTS(-114.82668694371746, 3, turning at positions 4:11, 0.9958232635119982, 15, DynamicHMC.Directions(0x958011eb)), DynamicHMC.TreeStatisticsNUTS(-114.98389145167263, 4, turning at positions -10:-17, 0.9744387377213863, 31, DynamicHMC.Directions(0xeaede30e)), DynamicHMC.TreeStatisticsNUTS(-115.05013841282998, 4, turning at positions 13:20, 0.9823322549414238, 31, DynamicHMC.Directions(0xc1fba834)), DynamicHMC.TreeStatisticsNUTS(-120.58337819095038, 3, turning at positions -2:5, 0.5987252395694135, 7, DynamicHMC.Directions(0x9488cb85)), DynamicHMC.TreeStatisticsNUTS(-120.78580582581598, 2, turning at positions -2:1, 0.9436877524785291, 3, DynamicHMC.Directions(0xfcf3fd71)), DynamicHMC.TreeStatisticsNUTS(-116.88288491999558, 3, turning at positions -7:0, 0.9373486418967395, 7, DynamicHMC.Directions(0x64aacbf8)), DynamicHMC.TreeStatisticsNUTS(-115.71986295964369, 2, turning at positions -2:1, 0.8948699638714143, 3, DynamicHMC.Directions(0x2dfd1a61)), DynamicHMC.TreeStatisticsNUTS(-115.89436745505223, 3, turning at positions -4:3, 0.9999999999999999, 7, DynamicHMC.Directions(0x841a23e3)), DynamicHMC.TreeStatisticsNUTS(-114.2925972339488, 3, turning at positions -2:5, 0.9718344330825597, 7, DynamicHMC.Directions(0x4ebb118d)), DynamicHMC.TreeStatisticsNUTS(-114.3777494811507, 3, turning at positions -1:6, 0.9731345279058424, 7, DynamicHMC.Directions(0x5298bf5e))], κ = Gaussian kinetic energy (WoodburyPDMat), √diag(M⁻¹): [0.07611872383250201, 0.1879314990493204, 0.12991366130961352, 0.8375617870452757, 0.5322283343782884], ϵ = 0.575723400288863)</code></pre><h2 id="AdvancedHMC.jl"><a class="docs-heading-anchor" href="#AdvancedHMC.jl">AdvancedHMC.jl</a><a id="AdvancedHMC.jl-1"></a><a class="docs-heading-anchor-permalink" href="#AdvancedHMC.jl" title="Permalink"></a></h2><p>Similar to Pathfinder, AdvancedHMC works with an unconstrained log density function and its gradient. We&#39;ll just use the <code>logp</code> we already created above.</p><pre><code class="language-julia hljs">using AdvancedHMC, ForwardDiff

nadapts = 500;</code></pre><h3 id="Initializing-from-Pathfinder&#39;s-draws-2"><a class="docs-heading-anchor" href="#Initializing-from-Pathfinder&#39;s-draws-2">Initializing from Pathfinder&#39;s draws</a><a class="docs-heading-anchor-permalink" href="#Initializing-from-Pathfinder&#39;s-draws-2" title="Permalink"></a></h3><pre><code class="language-julia hljs">metric = DiagEuclideanMetric(dim)
hamiltonian = Hamiltonian(metric, logp, ForwardDiff)
ϵ = find_good_stepsize(hamiltonian, init_params)
integrator = Leapfrog(ϵ)
proposal = NUTS{MultinomialTS,GeneralisedNoUTurn}(integrator)
adaptor = StepSizeAdaptor(0.8, integrator)
samples_ahmc1, stats_ahmc1 = sample(
    hamiltonian,
    proposal,
    init_params,
    ndraws + nadapts,
    adaptor,
    nadapts;
    drop_warmup=true,
    progress=false,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([[-0.4557125747014714, 0.3800811624648083, 0.20588235867220994, 0.944676327711183, -0.4895782484084552], [-0.32188377954073605, 0.1966630780231436, 1.7361222025997571, -0.5622301123439412, 0.12419121259678886], [-0.38165468089350374, 0.22819217940502173, -1.6410238525758554, 0.6072018705249415, 0.392617508160418], [-0.39031876021534556, 0.17456735923002575, 0.9699870962981474, 0.8646104053802012, -0.6395368570020058], [-0.3096267334303175, 0.3675467461935805, 1.2382632612643232, 0.981969806669796, -0.844509849256731], [-0.3328313624292043, 0.2299826829201351, 1.0255212783799672, 0.031558250583390124, -0.09896955214997377], [-0.34011972248884775, 0.2508887367512747, -0.20698385943315817, -0.19779524163063614, 0.4547423812958876], [-0.3183663328389485, 0.18624161606563172, 0.5279133815846998, -0.9291535783080609, 0.7071317778375632], [-0.4061065213087101, 0.2514500401754386, -0.6299982235358463, 0.678697908147238, 0.00041663228770184857], [-0.3972864304954393, 0.18261992870363405, -1.205893044136493, -0.3073738785717701, 0.8457394488294806]  …  [-0.24089545059158818, 0.2170478753348015, 0.8719409574253997, -0.025610522682334796, -0.05593347026206534], [-0.4437530119250252, 0.15991444661698448, 0.5395185180835463, 0.02957839659487431, 0.1255977111189483], [-0.3966625763764024, -0.003987547027473087, 0.5873429677731457, 0.027805240070837466, 0.16614649087219974], [-0.20308496700598877, 0.05250742125247225, 0.5390509573656216, -0.01610066771022998, 0.1598930771631481], [-0.3405547562186738, 0.44355280601785674, 0.482591429545155, -0.7340228580152927, 0.4641481920869318], [-0.31110354639451465, 0.39156831616269866, -0.49023985066454523, 1.3623077900763778, -0.5894885795482079], [-0.37604881050722405, 0.27702860438467525, 1.3297595786253122, -1.0000232881740503, 0.4456650710703916], [-0.4113698650114672, 0.2722886123382378, 0.41276995474309985, -0.9971572721597032, 0.7847063007643795], [-0.2891652633616807, 0.2606548497268888, 0.37963138911706545, -0.8470666238926112, 0.6853265312499105], [-0.35912216072109, 0.19871862119330214, 0.1433382330963086, -0.9807843550497678, 0.8458222902409583]], NamedTuple[(n_steps = 15, is_accept = true, acceptance_rate = 0.9387228768550275, log_density = -114.38316082423728, hamiltonian_energy = 116.46568256833767, hamiltonian_energy_error = -0.5161357856851083, max_hamiltonian_energy_error = 0.5321203250069857, tree_depth = 3, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9586569507142394, log_density = -114.1417474906836, hamiltonian_energy = 116.69997063827982, hamiltonian_energy_error = 0.03529876131021581, max_hamiltonian_energy_error = 0.19673331807753414, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.982633477123841, log_density = -114.06957592484234, hamiltonian_energy = 115.4435510798974, hamiltonian_energy_error = 0.029354821344711013, max_hamiltonian_energy_error = -0.12956882034316664, tree_depth = 7, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.6067026949871018, log_density = -114.15720323800406, hamiltonian_energy = 117.32494096759706, hamiltonian_energy_error = 0.13999508386672233, max_hamiltonian_energy_error = 1.4182418737418203, tree_depth = 7, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 31, is_accept = true, acceptance_rate = 0.9959322359444048, log_density = -114.22495669443742, hamiltonian_energy = 116.33733770982907, hamiltonian_energy_error = -0.3173435669962572, max_hamiltonian_energy_error = -0.41153034808357347, tree_depth = 4, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.959350496204626, log_density = -112.70214130748242, hamiltonian_energy = 116.06436692973182, hamiltonian_energy_error = -0.02977606465321969, max_hamiltonian_energy_error = 0.1468216543184866, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 73, is_accept = true, acceptance_rate = 0.7223324549767951, log_density = -112.28541329119666, hamiltonian_energy = 113.84767571030602, hamiltonian_energy_error = -0.01434655661566353, max_hamiltonian_energy_error = 0.7718228134312142, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.8075341728737518, log_density = -113.49529222710524, hamiltonian_energy = 114.84759503371538, hamiltonian_energy_error = 0.20963179285229216, max_hamiltonian_energy_error = 0.534631515396498, tree_depth = 5, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 55, is_accept = true, acceptance_rate = 0.9840911392171637, log_density = -113.03439308689373, hamiltonian_energy = 115.63416700576667, hamiltonian_energy_error = -0.10851682549397879, max_hamiltonian_energy_error = -0.23215893203325777, tree_depth = 5, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.7763425508749321, log_density = -114.94607629173555, hamiltonian_energy = 115.45384718025423, hamiltonian_energy_error = 0.6499272915881704, max_hamiltonian_energy_error = 0.6499272915881704, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false)  …  (n_steps = 127, is_accept = true, acceptance_rate = 0.6137502639149606, log_density = -114.79095038083123, hamiltonian_energy = 115.98935720010469, hamiltonian_energy_error = 0.7364571243075915, max_hamiltonian_energy_error = 1.2373896117227758, tree_depth = 7, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 31, is_accept = true, acceptance_rate = 0.7909148620001354, log_density = -113.37391572380876, hamiltonian_energy = 116.20483890532464, hamiltonian_energy_error = -1.0293704075850485, max_hamiltonian_energy_error = 1.1222806364637137, tree_depth = 4, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.5457725482895344, log_density = -114.32963638684039, hamiltonian_energy = 117.46809643219626, hamiltonian_energy_error = 0.19658065884941323, max_hamiltonian_energy_error = 1.0362298431042802, tree_depth = 2, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.8934679878980039, log_density = -115.32572585186851, hamiltonian_energy = 116.06818935917528, hamiltonian_energy_error = 0.25800696898700437, max_hamiltonian_energy_error = 0.25800696898700437, tree_depth = 3, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.9834802510804878, log_density = -114.02008732458982, hamiltonian_energy = 116.38642465169609, hamiltonian_energy_error = -0.1643736168790184, max_hamiltonian_energy_error = -0.3837939822414427, tree_depth = 5, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.9475823402256733, log_density = -114.52940048864701, hamiltonian_energy = 115.35864727507843, hamiltonian_energy_error = 0.06048267567554433, max_hamiltonian_energy_error = 0.22665528238960064, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 79, is_accept = true, acceptance_rate = 0.990706526152731, log_density = -114.01231875761697, hamiltonian_energy = 116.22339963430446, hamiltonian_energy_error = -0.06912001923353728, max_hamiltonian_energy_error = -0.26529061829197076, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9974936205935787, log_density = -113.3294102220404, hamiltonian_energy = 115.076064572479, hamiltonian_energy_error = -0.1734750284756501, max_hamiltonian_energy_error = -0.18084483432775755, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 23, is_accept = true, acceptance_rate = 0.982047597732999, log_density = -113.18948247707681, hamiltonian_energy = 113.7333623682615, hamiltonian_energy_error = 0.043338697271138926, max_hamiltonian_energy_error = 0.05077864215633099, tree_depth = 4, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.6930462271180139, log_density = -113.95350383427703, hamiltonian_energy = 116.57223064408532, hamiltonian_energy_error = 0.19298680961878745, max_hamiltonian_energy_error = 1.1218245004761513, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false)])</code></pre><h3 id="Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate-2"><a class="docs-heading-anchor" href="#Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate-2">Initializing metric adaptation from Pathfinder&#39;s estimate</a><a class="docs-heading-anchor-permalink" href="#Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate-2" title="Permalink"></a></h3><p>We can&#39;t start with Pathfinder&#39;s inverse metric estimate directly. Instead we need to first extract its diagonal for a <code>DiagonalEuclideanMetric</code> or make it dense for a <code>DenseEuclideanMetric</code>:</p><pre><code class="language-julia hljs">metric = DenseEuclideanMetric(Matrix(inv_metric))
hamiltonian = Hamiltonian(metric, logp, ForwardDiff)
ϵ = find_good_stepsize(hamiltonian, init_params)
integrator = Leapfrog(ϵ)
proposal = NUTS{MultinomialTS,GeneralisedNoUTurn}(integrator)
adaptor = StepSizeAdaptor(0.8, integrator)
samples_ahmc2, stats_ahmc2 = sample(
    hamiltonian,
    proposal,
    init_params,
    ndraws + nadapts,
    adaptor,
    nadapts;
    drop_warmup=true,
    progress=false,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([[-0.25122541500555406, 0.10949673957567131, -1.2760126620865637, 0.29854282734653015, 0.5702695741149104], [-0.33939134831624396, 0.20289730119740146, -1.279207457287558, 0.23384721915315745, 0.5580955492728409], [-0.3861413059500781, 0.2615903264329002, -1.3257921467782952, -0.6523520765429105, 1.1576806552697079], [-0.20116610259414228, 0.08766423255609573, -1.2917322013392014, -0.5696086369947502, 1.1415835955932663], [-0.35154715422090316, 0.10953928846194039, -1.448211795496119, 0.6153849955017634, 0.4234094252877255], [-0.2598234565504887, 0.38117694499567395, -1.4001772704035118, -0.21764082156732534, 0.8545100189572536], [-0.20526705092035363, 0.11255864797095266, -0.5498448528027292, 0.24385734746463333, 0.3659834403761768], [-0.23549362540499888, 0.3506436200902892, -0.3838125138220584, 0.27319949739405724, 0.19178035903786067], [-0.3687525461367468, 0.4478828383740572, -0.3868505938527842, 0.40071498008762746, 0.05531114217025934], [-0.2758566070811565, 0.1690886053206629, -0.13376763960712315, -0.7277817420270554, 0.8304295396873803]  …  [-0.16904711547701828, 0.027638242841297275, 0.45478028943123644, 1.7751836027297698, -0.974213715082624], [-0.30601530927977555, 0.2029529721973256, 0.45897269949999986, 0.7468219773049534, -0.382390386929508], [-0.3494975976283472, 0.20547699663558305, 0.8012776638555965, 1.3483405610540067, -0.815823886870779], [-0.3667630664019049, 0.38850260918020174, 0.6826830289638169, 1.9723219924112663, -1.4221952967578604], [-0.29756632377136155, 0.313073804148892, 0.6283308452236328, 2.538074538462113, -1.668766033152742], [-0.39450660295703266, 0.08260082009269373, 1.1159469033109917, -1.8888447582926482, 1.223129062673224], [-0.3474738228177411, 0.07545525250990398, -0.259810474202108, -2.1250405782727113, 1.8476832909367193], [-0.2802353211332677, 0.18759156742284755, -0.7369190171494411, 1.4032850259034613, -0.31095059551137705], [-0.45391683086825146, 0.25088672721912963, -0.7193429702185627, -0.21719757328483758, 0.5868864698506385], [-0.2766700442304879, 0.41811569750651606, -0.6353542800368188, -1.6522101479641937, 1.5166479531753323]], NamedTuple[(n_steps = 3, is_accept = true, acceptance_rate = 0.9616395517999635, log_density = -114.4226996947398, hamiltonian_energy = 115.74777750310992, hamiltonian_energy_error = -0.08300905853583629, max_hamiltonian_energy_error = -0.2517782248622211, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.9995501118850814, log_density = -113.12145897961784, hamiltonian_energy = 114.36353060152204, hamiltonian_energy_error = -0.17774464669544443, max_hamiltonian_energy_error = -0.17774464669544443, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 31, is_accept = true, acceptance_rate = 0.7782903983645025, log_density = -114.01905701589037, hamiltonian_energy = 116.27169198517556, hamiltonian_energy_error = 0.08454206834366573, max_hamiltonian_energy_error = 0.5442009025646115, tree_depth = 5, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.7134813379438287, log_density = -116.34830759108945, hamiltonian_energy = 117.26119001875004, hamiltonian_energy_error = 0.36872020110278925, max_hamiltonian_energy_error = 0.36872020110278925, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.7620996223709318, log_density = -113.89216759153845, hamiltonian_energy = 117.5778241916345, hamiltonian_energy_error = -0.45215310482083737, max_hamiltonian_energy_error = 0.5427029502853884, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.606941351145413, log_density = -114.98998843929166, hamiltonian_energy = 116.48705960347638, hamiltonian_energy_error = 0.505243324275753, max_hamiltonian_energy_error = 1.0415304540837411, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 23, is_accept = true, acceptance_rate = 0.7132869870968319, log_density = -114.61980268867623, hamiltonian_energy = 119.56908952356599, hamiltonian_energy_error = -0.14326912596213504, max_hamiltonian_energy_error = 2.064510026657942, tree_depth = 4, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.7191347805123005, log_density = -113.8405083185036, hamiltonian_energy = 119.25731246007129, hamiltonian_energy_error = 0.009850870280530444, max_hamiltonian_energy_error = 1.0441543775726103, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.9735009824530925, log_density = -113.49377232953955, hamiltonian_energy = 114.74486876522873, hamiltonian_energy_error = -0.07202182398040691, max_hamiltonian_energy_error = -0.38931787410203356, tree_depth = 3, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.9398443490486214, log_density = -113.37783313284358, hamiltonian_energy = 114.43243625839756, hamiltonian_energy_error = -0.1914255107377727, max_hamiltonian_energy_error = -0.3465166556995456, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false)  …  (n_steps = 43, is_accept = true, acceptance_rate = 0.9950478515670514, log_density = -118.1522361275591, hamiltonian_energy = 121.43364434176263, hamiltonian_energy_error = -0.02714999448782862, max_hamiltonian_energy_error = -0.9530245956075163, tree_depth = 5, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 1.0, log_density = -112.93617106754782, hamiltonian_energy = 118.39005825043695, hamiltonian_energy_error = -0.7053571797275424, max_hamiltonian_energy_error = -0.7053571797275424, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 23, is_accept = true, acceptance_rate = 0.4791743326262729, log_density = -114.65680683422713, hamiltonian_energy = 117.64251258129848, hamiltonian_energy_error = 0.30127536306235925, max_hamiltonian_energy_error = 2.236641140982144, tree_depth = 4, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.8164467498179621, log_density = -117.922382635397, hamiltonian_energy = 118.80243857713953, hamiltonian_energy_error = 0.5203074765352937, max_hamiltonian_energy_error = 0.5203074765352937, tree_depth = 3, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.919237375912581, log_density = -117.26729833831413, hamiltonian_energy = 121.25533202271147, hamiltonian_energy_error = 0.13082722912334077, max_hamiltonian_energy_error = -0.4456696978781167, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.9779763588983382, log_density = -116.2612297603507, hamiltonian_energy = 118.36155243669779, hamiltonian_energy_error = 0.06835477865254802, max_hamiltonian_energy_error = -0.8461790555112145, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 43, is_accept = true, acceptance_rate = 0.9994334527959674, log_density = -116.85323720107162, hamiltonian_energy = 117.93557992726697, hamiltonian_energy_error = -0.04588100478909496, max_hamiltonian_energy_error = -0.766594093650113, tree_depth = 5, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.9536378444177022, log_density = -115.50883046348345, hamiltonian_energy = 119.7673936142155, hamiltonian_energy_error = -0.27859312719907336, max_hamiltonian_energy_error = -0.5365776975770729, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 31, is_accept = true, acceptance_rate = 0.9382316547636954, log_density = -115.368321857462, hamiltonian_energy = 117.53057970441789, hamiltonian_energy_error = 0.19588269215893206, max_hamiltonian_energy_error = -0.49251957876650465, tree_depth = 4, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 15, is_accept = true, acceptance_rate = 0.990021836476401, log_density = -116.06454801454038, hamiltonian_energy = 117.80264543373924, hamiltonian_energy_error = -0.03871309815508539, max_hamiltonian_energy_error = -0.6043258864569623, tree_depth = 3, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false)])</code></pre><h3 id="Use-Pathfinder&#39;s-metric-estimate-for-sampling-2"><a class="docs-heading-anchor" href="#Use-Pathfinder&#39;s-metric-estimate-for-sampling-2">Use Pathfinder&#39;s metric estimate for sampling</a><a class="docs-heading-anchor-permalink" href="#Use-Pathfinder&#39;s-metric-estimate-for-sampling-2" title="Permalink"></a></h3><p>To use Pathfinder&#39;s metric with no metric adaptation, we need to use Pathfinder&#39;s own <code>RankUpdateEuclideanMetric</code> type, which just wraps our inverse metric estimate for use with AdvancedHMC:</p><pre><code class="language-julia hljs">nadapts = 75
metric = Pathfinder.RankUpdateEuclideanMetric(inv_metric)
hamiltonian = Hamiltonian(metric, logp, ForwardDiff)
ϵ = find_good_stepsize(hamiltonian, init_params)
integrator = Leapfrog(ϵ)
proposal = NUTS{MultinomialTS,GeneralisedNoUTurn}(integrator)
adaptor = StepSizeAdaptor(0.8, integrator)
samples_ahmc3, stats_ahmc3 = sample(
    hamiltonian,
    proposal,
    init_params,
    ndraws + nadapts,
    adaptor,
    nadapts;
    drop_warmup=true,
    progress=false,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([[-0.24902439848233077, -0.10991844254536567, -0.9601058268845304, -0.4828874992015843, 1.0834196002105945], [-0.1593486460421001, 0.5091704980971072, -0.1761761223524865, 1.0132015835315684, -0.5054938842392962], [-0.3226288887321947, 0.5110970258254058, -0.22079202914758256, 1.0051506835204442, -0.4804877297905012], [-0.17057540988828798, 0.1036963025353401, 0.018061641499443178, 1.7387258481246344, -0.7645512016987571], [-0.27829193312416994, 0.2355622342942481, 0.3329115668805658, -0.90233962261438, 0.7654695593497728], [-0.31001383875719823, 0.3479907919310838, 0.3825183914102286, -0.6011769706227986, 0.5014977531731996], [-0.3303344285193195, 0.3366067482479861, -1.4456779348771456, 0.6104301131317268, 0.29674285916513676], [-0.3814322147892073, 0.3868953929955496, 1.6927856155205765, -0.022184250450825838, -0.3399838281243075], [-0.29269727748162594, 0.303093598878723, 1.752188112354116, -0.017111759736629338, -0.3401770625679102], [-0.2865928692881079, 0.3035995142641702, 1.7550957423155387, 0.011548791906061374, -0.3052711052747081]  …  [-0.37534029793619605, 0.17391137718943453, 2.0118976119079255, -0.6229542625573892, 0.052684400885913224], [-0.2006197323534959, 0.21741690613596004, 1.4926743113242553, -1.2349423264591393, 0.6055889433267825], [-0.3527451367284729, 0.279238932711768, -1.3786716064458702, 1.4238163107986888, -0.19511790127905135], [-0.37735262870887354, 0.3133275259786561, -2.2287963361197747, 1.3023306309070248, 0.18496748206841507], [-0.28012971682808135, 0.2682554629275966, -1.910628544080617, 0.9083527023919126, 0.2780935351910749], [-0.46049742530576643, 0.19247145727512807, 0.28481249029216094, 1.603673416759744, -0.8780856564337735], [-0.2925506118247857, 0.33616913411196625, -0.5021653529708796, -0.3253339933615885, 0.6524153369151764], [-0.29641286646614756, 0.17615660132110744, -0.7151133703613524, -0.15358506441501324, 0.6140358097676234], [-0.40284229285388873, 0.28259163323869435, 0.9128884756419883, 0.028872424372777733, -0.08095193590401016], [-0.2960968774441115, 0.19134991833831114, 0.24228511483021206, 0.9371859360253901, -0.4055006725110227]], NamedTuple[(n_steps = 7, is_accept = true, acceptance_rate = 0.9749755369610215, log_density = -116.93441957853955, hamiltonian_energy = 119.7522884897536, hamiltonian_energy_error = -0.006846203157422792, max_hamiltonian_energy_error = 0.06556044280793571, tree_depth = 3, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9876464778497797, log_density = -117.49250512858642, hamiltonian_energy = 119.01619573158402, hamiltonian_energy_error = 0.05312277625782258, max_hamiltonian_energy_error = -0.10822424499127692, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.925510794647951, log_density = -114.71944218778974, hamiltonian_energy = 118.41413582374572, hamiltonian_energy_error = -0.20652585769509813, max_hamiltonian_energy_error = -0.20652585769509813, tree_depth = 3, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 39, is_accept = true, acceptance_rate = 0.8542634953057646, log_density = -117.8673236372395, hamiltonian_energy = 122.53616969665218, hamiltonian_energy_error = 0.2517828275926348, max_hamiltonian_energy_error = 0.3890002282557816, tree_depth = 5, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 79, is_accept = true, acceptance_rate = 0.9664142071853736, log_density = -113.3273709931619, hamiltonian_energy = 118.64847641532468, hamiltonian_energy_error = -0.23429459314347412, max_hamiltonian_energy_error = -0.39363699679080355, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.984492329252199, log_density = -112.86778891508858, hamiltonian_energy = 115.35264610745406, hamiltonian_energy_error = -0.012419991126392915, max_hamiltonian_energy_error = 0.049580828339799154, tree_depth = 5, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9999872355607389, log_density = -113.58951342454299, hamiltonian_energy = 115.68077486631158, hamiltonian_energy_error = -0.011225967456141461, max_hamiltonian_energy_error = -0.01512478204119816, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9055141499527674, log_density = -114.20077892980986, hamiltonian_energy = 115.96064188125276, hamiltonian_energy_error = 0.0067990454472379724, max_hamiltonian_energy_error = 0.22961763096560617, tree_depth = 7, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 15, is_accept = true, acceptance_rate = 0.9874421750265507, log_density = -114.09798008332146, hamiltonian_energy = 115.08966419676462, hamiltonian_energy_error = 0.007993080251026186, max_hamiltonian_energy_error = 0.03957094028302777, tree_depth = 3, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.8730921018654657, log_density = -114.63593707773983, hamiltonian_energy = 115.18928455123164, hamiltonian_energy_error = 0.12696593623030594, max_hamiltonian_energy_error = 0.2274446185148662, tree_depth = 2, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false)  …  (n_steps = 95, is_accept = true, acceptance_rate = 0.9856373365450172, log_density = -114.46275710878118, hamiltonian_energy = 118.21378878699986, hamiltonian_energy_error = -0.1525343428629924, max_hamiltonian_energy_error = -0.15605821958926924, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9254335313448646, log_density = -116.22828167369974, hamiltonian_energy = 118.3515797342215, hamiltonian_energy_error = 0.11097685200648755, max_hamiltonian_energy_error = 0.16686853111548317, tree_depth = 7, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9627502988689879, log_density = -114.51354988178942, hamiltonian_energy = 118.10085839366971, hamiltonian_energy_error = -0.0351889306522537, max_hamiltonian_energy_error = 0.21339352533333056, tree_depth = 7, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.8378446481186331, log_density = -117.22420543143139, hamiltonian_energy = 118.82764972551759, hamiltonian_energy_error = 0.3439247997991828, max_hamiltonian_energy_error = 0.4653070625299307, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 31, is_accept = true, acceptance_rate = 0.9007173404427807, log_density = -114.89050744154667, hamiltonian_energy = 119.73736981220927, hamiltonian_energy_error = -0.2924421649029654, max_hamiltonian_energy_error = -0.4853548959736287, tree_depth = 4, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9877753717417196, log_density = -115.20039731286478, hamiltonian_energy = 117.49256884795054, hamiltonian_energy_error = 0.04799469718476246, max_hamiltonian_energy_error = 0.05434125625711772, tree_depth = 7, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 71, is_accept = true, acceptance_rate = 0.8969989605132138, log_density = -113.42097800301843, hamiltonian_energy = 118.72028379891296, hamiltonian_energy_error = 0.15175346501267484, max_hamiltonian_energy_error = 0.25601997024028833, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9986522372980194, log_density = -113.23455862054934, hamiltonian_energy = 114.05239908741166, hamiltonian_energy_error = -0.038945283404203224, max_hamiltonian_energy_error = -0.15388979865939234, tree_depth = 7, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9951862587888851, log_density = -112.82463834550275, hamiltonian_energy = 113.81550406992302, hamiltonian_energy_error = -0.09510694357319949, max_hamiltonian_energy_error = -0.11129879731430492, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.998880898541872, log_density = -112.96732477031665, hamiltonian_energy = 114.5211467621212, hamiltonian_energy_error = -0.007377424356391771, max_hamiltonian_energy_error = -0.022218336620696277, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false)])</code></pre><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>https://mc-stan.org/docs/reference-manual/hmc-algorithm-parameters.html</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../quickstart/">« Quickstart</a><a class="docs-footer-nextpage" href="../turing/">Turing usage »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.16 on <span class="colophon-date" title="Wednesday 4 May 2022 02:22">Wednesday 4 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
