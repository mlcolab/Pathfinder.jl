<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Initializing HMC · Pathfinder.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://sethaxen.github.io/Pathfinder.jl/examples/initializing-hmc/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Pathfinder.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../lib/public/">Public</a></li><li><a class="tocitem" href="../../lib/internals/">Internals</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../quickstart/">Quickstart</a></li><li class="is-active"><a class="tocitem" href>Initializing HMC</a><ul class="internal"><li><a class="tocitem" href="#The-MCMC-warm-up-phase"><span>The MCMC warm-up phase</span></a></li><li><a class="tocitem" href="#DynamicHMC.jl"><span>DynamicHMC.jl</span></a></li><li><a class="tocitem" href="#AdvancedHMC.jl"><span>AdvancedHMC.jl</span></a></li></ul></li><li><a class="tocitem" href="../turing/">Turing usage</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Initializing HMC</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Initializing HMC</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sethaxen/Pathfinder.jl/blob/main/docs/src/examples/initializing-hmc.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Initializing-HMC-with-Pathfinder"><a class="docs-heading-anchor" href="#Initializing-HMC-with-Pathfinder">Initializing HMC with Pathfinder</a><a id="Initializing-HMC-with-Pathfinder-1"></a><a class="docs-heading-anchor-permalink" href="#Initializing-HMC-with-Pathfinder" title="Permalink"></a></h1><h2 id="The-MCMC-warm-up-phase"><a class="docs-heading-anchor" href="#The-MCMC-warm-up-phase">The MCMC warm-up phase</a><a id="The-MCMC-warm-up-phase-1"></a><a class="docs-heading-anchor-permalink" href="#The-MCMC-warm-up-phase" title="Permalink"></a></h2><p>When using MCMC to draw samples from some target distribution, there is often a lengthy warm-up phase with 2 phases:</p><ol><li>converge to the <em>typical set</em> (the region of the target distribution where the bulk of the probability mass is located)</li><li>adapt any tunable parameters of the MCMC sampler (optional)</li></ol><p>While (1) often happens fairly quickly, (2) usually requires a lengthy exploration of the typical set to iteratively adapt parameters suitable for further exploration. An example is the widely used windowed adaptation scheme of Hamiltonian Monte Carlo (HMC) in Stan, where a step size and positive definite metric (aka mass matrix) are adapted.<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> For posteriors with complex geometry, the adaptation phase can require many evaluations of the gradient of the log density function of the target distribution.</p><p>Pathfinder can be used to initialize MCMC, and in particular HMC, in 3 ways:</p><ol><li>Initialize MCMC from one of Pathfinder&#39;s draws (replace phase 1 of the warm-up).</li><li>Initialize an HMC metric adaptation from the inverse of the covariance of the multivariate normal approximation (replace the first window of phase 2 of the warm-up).</li><li>Use the inverse of the covariance as the metric without further adaptation (replace phase 2 of the warm-up).</li></ol><p>This tutorial demonstrates all three approaches with <a href="https://tamaspapp.eu/DynamicHMC.jl/stable/">DynamicHMC.jl</a> and <a href="https://github.com/TuringLang/AdvancedHMC.jl">AdvancedHMC.jl</a>. Both of these packages have standalone implementations of adaptive HMC (aka NUTS) and can be used independently of any probabilistic programming language (PPL). Both the <a href="https://turing.ml/stable/">Turing</a> and <a href="https://github.com/cscherrer/Soss.jl">Soss</a> PPLs have some DynamicHMC integration, while Turing also integrates with AdvancedHMC.</p><p>For demonstration purposes, we&#39;ll use the following dummy data:</p><pre><code class="language-julia hljs">using LinearAlgebra, Pathfinder, Random, StatsFuns, StatsPlots

Random.seed!(91)

x = 0:0.01:1
y = @. sin(10x) + randn() * 0.2 + x

scatter(x, y; xlabel=&quot;x&quot;, ylabel=&quot;y&quot;, legend=false, msw=0, ms=2)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip870">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip870)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip871">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip870)" d="
M210.746 1423.18 L2352.76 1423.18 L2352.76 47.2441 L210.746 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip872">
    <rect x="210" y="47" width="2143" height="1377"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip872)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  271.369,1423.18 271.369,47.2441 
  "/>
<polyline clip-path="url(#clip872)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  776.56,1423.18 776.56,47.2441 
  "/>
<polyline clip-path="url(#clip872)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1281.75,1423.18 1281.75,47.2441 
  "/>
<polyline clip-path="url(#clip872)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1786.94,1423.18 1786.94,47.2441 
  "/>
<polyline clip-path="url(#clip872)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2292.13,1423.18 2292.13,47.2441 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  210.746,1423.18 2352.76,1423.18 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  271.369,1423.18 271.369,1404.28 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  776.56,1423.18 776.56,1404.28 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1281.75,1423.18 1281.75,1404.28 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1786.94,1423.18 1786.94,1404.28 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2292.13,1423.18 2292.13,1404.28 
  "/>
<path clip-path="url(#clip870)" d="M233.672 1454.1 Q230.061 1454.1 228.233 1457.66 Q226.427 1461.2 226.427 1468.33 Q226.427 1475.44 228.233 1479.01 Q230.061 1482.55 233.672 1482.55 Q237.307 1482.55 239.112 1479.01 Q240.941 1475.44 240.941 1468.33 Q240.941 1461.2 239.112 1457.66 Q237.307 1454.1 233.672 1454.1 M233.672 1450.39 Q239.482 1450.39 242.538 1455 Q245.617 1459.58 245.617 1468.33 Q245.617 1477.06 242.538 1481.67 Q239.482 1486.25 233.672 1486.25 Q227.862 1486.25 224.783 1481.67 Q221.728 1477.06 221.728 1468.33 Q221.728 1459.58 224.783 1455 Q227.862 1450.39 233.672 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M253.834 1479.7 L258.718 1479.7 L258.718 1485.58 L253.834 1485.58 L253.834 1479.7 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M278.904 1454.1 Q275.292 1454.1 273.464 1457.66 Q271.658 1461.2 271.658 1468.33 Q271.658 1475.44 273.464 1479.01 Q275.292 1482.55 278.904 1482.55 Q282.538 1482.55 284.343 1479.01 Q286.172 1475.44 286.172 1468.33 Q286.172 1461.2 284.343 1457.66 Q282.538 1454.1 278.904 1454.1 M278.904 1450.39 Q284.714 1450.39 287.769 1455 Q290.848 1459.58 290.848 1468.33 Q290.848 1477.06 287.769 1481.67 Q284.714 1486.25 278.904 1486.25 Q273.093 1486.25 270.015 1481.67 Q266.959 1477.06 266.959 1468.33 Q266.959 1459.58 270.015 1455 Q273.093 1450.39 278.904 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M309.065 1454.1 Q305.454 1454.1 303.626 1457.66 Q301.82 1461.2 301.82 1468.33 Q301.82 1475.44 303.626 1479.01 Q305.454 1482.55 309.065 1482.55 Q312.7 1482.55 314.505 1479.01 Q316.334 1475.44 316.334 1468.33 Q316.334 1461.2 314.505 1457.66 Q312.7 1454.1 309.065 1454.1 M309.065 1450.39 Q314.876 1450.39 317.931 1455 Q321.01 1459.58 321.01 1468.33 Q321.01 1477.06 317.931 1481.67 Q314.876 1486.25 309.065 1486.25 Q303.255 1486.25 300.177 1481.67 Q297.121 1477.06 297.121 1468.33 Q297.121 1459.58 300.177 1455 Q303.255 1450.39 309.065 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M739.361 1454.1 Q735.75 1454.1 733.921 1457.66 Q732.116 1461.2 732.116 1468.33 Q732.116 1475.44 733.921 1479.01 Q735.75 1482.55 739.361 1482.55 Q742.995 1482.55 744.801 1479.01 Q746.63 1475.44 746.63 1468.33 Q746.63 1461.2 744.801 1457.66 Q742.995 1454.1 739.361 1454.1 M739.361 1450.39 Q745.171 1450.39 748.227 1455 Q751.305 1459.58 751.305 1468.33 Q751.305 1477.06 748.227 1481.67 Q745.171 1486.25 739.361 1486.25 Q733.551 1486.25 730.472 1481.67 Q727.417 1477.06 727.417 1468.33 Q727.417 1459.58 730.472 1455 Q733.551 1450.39 739.361 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M759.523 1479.7 L764.407 1479.7 L764.407 1485.58 L759.523 1485.58 L759.523 1479.7 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M778.62 1481.64 L794.939 1481.64 L794.939 1485.58 L772.995 1485.58 L772.995 1481.64 Q775.657 1478.89 780.24 1474.26 Q784.847 1469.61 786.027 1468.27 Q788.273 1465.74 789.152 1464.01 Q790.055 1462.25 790.055 1460.56 Q790.055 1457.8 788.111 1456.07 Q786.189 1454.33 783.088 1454.33 Q780.889 1454.33 778.435 1455.09 Q776.004 1455.86 773.227 1457.41 L773.227 1452.69 Q776.051 1451.55 778.504 1450.97 Q780.958 1450.39 782.995 1450.39 Q788.365 1450.39 791.56 1453.08 Q794.754 1455.77 794.754 1460.26 Q794.754 1462.39 793.944 1464.31 Q793.157 1466.2 791.051 1468.8 Q790.472 1469.47 787.37 1472.69 Q784.268 1475.88 778.62 1481.64 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M804.8 1451.02 L823.157 1451.02 L823.157 1454.96 L809.083 1454.96 L809.083 1463.43 Q810.101 1463.08 811.12 1462.92 Q812.138 1462.73 813.157 1462.73 Q818.944 1462.73 822.324 1465.9 Q825.703 1469.08 825.703 1474.49 Q825.703 1480.07 822.231 1483.17 Q818.759 1486.25 812.439 1486.25 Q810.263 1486.25 807.995 1485.88 Q805.75 1485.51 803.342 1484.77 L803.342 1480.07 Q805.425 1481.2 807.648 1481.76 Q809.87 1482.32 812.347 1482.32 Q816.351 1482.32 818.689 1480.21 Q821.027 1478.1 821.027 1474.49 Q821.027 1470.88 818.689 1468.77 Q816.351 1466.67 812.347 1466.67 Q810.472 1466.67 808.597 1467.08 Q806.745 1467.5 804.8 1468.38 L804.8 1451.02 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M1244.05 1454.1 Q1240.44 1454.1 1238.61 1457.66 Q1236.81 1461.2 1236.81 1468.33 Q1236.81 1475.44 1238.61 1479.01 Q1240.44 1482.55 1244.05 1482.55 Q1247.69 1482.55 1249.49 1479.01 Q1251.32 1475.44 1251.32 1468.33 Q1251.32 1461.2 1249.49 1457.66 Q1247.69 1454.1 1244.05 1454.1 M1244.05 1450.39 Q1249.86 1450.39 1252.92 1455 Q1256 1459.58 1256 1468.33 Q1256 1477.06 1252.92 1481.67 Q1249.86 1486.25 1244.05 1486.25 Q1238.24 1486.25 1235.17 1481.67 Q1232.11 1477.06 1232.11 1468.33 Q1232.11 1459.58 1235.17 1455 Q1238.24 1450.39 1244.05 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M1264.22 1479.7 L1269.1 1479.7 L1269.1 1485.58 L1264.22 1485.58 L1264.22 1479.7 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M1279.33 1451.02 L1297.69 1451.02 L1297.69 1454.96 L1283.61 1454.96 L1283.61 1463.43 Q1284.63 1463.08 1285.65 1462.92 Q1286.67 1462.73 1287.69 1462.73 Q1293.48 1462.73 1296.86 1465.9 Q1300.23 1469.08 1300.23 1474.49 Q1300.23 1480.07 1296.76 1483.17 Q1293.29 1486.25 1286.97 1486.25 Q1284.79 1486.25 1282.53 1485.88 Q1280.28 1485.51 1277.87 1484.77 L1277.87 1480.07 Q1279.96 1481.2 1282.18 1481.76 Q1284.4 1482.32 1286.88 1482.32 Q1290.88 1482.32 1293.22 1480.21 Q1295.56 1478.1 1295.56 1474.49 Q1295.56 1470.88 1293.22 1468.77 Q1290.88 1466.67 1286.88 1466.67 Q1285 1466.67 1283.13 1467.08 Q1281.28 1467.5 1279.33 1468.38 L1279.33 1451.02 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M1319.45 1454.1 Q1315.84 1454.1 1314.01 1457.66 Q1312.2 1461.2 1312.2 1468.33 Q1312.2 1475.44 1314.01 1479.01 Q1315.84 1482.55 1319.45 1482.55 Q1323.08 1482.55 1324.89 1479.01 Q1326.72 1475.44 1326.72 1468.33 Q1326.72 1461.2 1324.89 1457.66 Q1323.08 1454.1 1319.45 1454.1 M1319.45 1450.39 Q1325.26 1450.39 1328.31 1455 Q1331.39 1459.58 1331.39 1468.33 Q1331.39 1477.06 1328.31 1481.67 Q1325.26 1486.25 1319.45 1486.25 Q1313.64 1486.25 1310.56 1481.67 Q1307.5 1477.06 1307.5 1468.33 Q1307.5 1459.58 1310.56 1455 Q1313.64 1450.39 1319.45 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M1749.74 1454.1 Q1746.13 1454.1 1744.3 1457.66 Q1742.5 1461.2 1742.5 1468.33 Q1742.5 1475.44 1744.3 1479.01 Q1746.13 1482.55 1749.74 1482.55 Q1753.38 1482.55 1755.18 1479.01 Q1757.01 1475.44 1757.01 1468.33 Q1757.01 1461.2 1755.18 1457.66 Q1753.38 1454.1 1749.74 1454.1 M1749.74 1450.39 Q1755.55 1450.39 1758.61 1455 Q1761.69 1459.58 1761.69 1468.33 Q1761.69 1477.06 1758.61 1481.67 Q1755.55 1486.25 1749.74 1486.25 Q1743.93 1486.25 1740.85 1481.67 Q1737.8 1477.06 1737.8 1468.33 Q1737.8 1459.58 1740.85 1455 Q1743.93 1450.39 1749.74 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M1769.91 1479.7 L1774.79 1479.7 L1774.79 1485.58 L1769.91 1485.58 L1769.91 1479.7 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M1783.79 1451.02 L1806.02 1451.02 L1806.02 1453.01 L1793.47 1485.58 L1788.59 1485.58 L1800.39 1454.96 L1783.79 1454.96 L1783.79 1451.02 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M1815.18 1451.02 L1833.54 1451.02 L1833.54 1454.96 L1819.46 1454.96 L1819.46 1463.43 Q1820.48 1463.08 1821.5 1462.92 Q1822.52 1462.73 1823.54 1462.73 Q1829.33 1462.73 1832.71 1465.9 Q1836.09 1469.08 1836.09 1474.49 Q1836.09 1480.07 1832.61 1483.17 Q1829.14 1486.25 1822.82 1486.25 Q1820.65 1486.25 1818.38 1485.88 Q1816.13 1485.51 1813.72 1484.77 L1813.72 1480.07 Q1815.81 1481.2 1818.03 1481.76 Q1820.25 1482.32 1822.73 1482.32 Q1826.73 1482.32 1829.07 1480.21 Q1831.41 1478.1 1831.41 1474.49 Q1831.41 1470.88 1829.07 1468.77 Q1826.73 1466.67 1822.73 1466.67 Q1820.85 1466.67 1818.98 1467.08 Q1817.13 1467.5 1815.18 1468.38 L1815.18 1451.02 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M2244.2 1481.64 L2251.84 1481.64 L2251.84 1455.28 L2243.53 1456.95 L2243.53 1452.69 L2251.8 1451.02 L2256.47 1451.02 L2256.47 1481.64 L2264.11 1481.64 L2264.11 1485.58 L2244.2 1485.58 L2244.2 1481.64 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M2273.56 1479.7 L2278.44 1479.7 L2278.44 1485.58 L2273.56 1485.58 L2273.56 1479.7 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M2298.63 1454.1 Q2295.01 1454.1 2293.19 1457.66 Q2291.38 1461.2 2291.38 1468.33 Q2291.38 1475.44 2293.19 1479.01 Q2295.01 1482.55 2298.63 1482.55 Q2302.26 1482.55 2304.07 1479.01 Q2305.89 1475.44 2305.89 1468.33 Q2305.89 1461.2 2304.07 1457.66 Q2302.26 1454.1 2298.63 1454.1 M2298.63 1450.39 Q2304.44 1450.39 2307.49 1455 Q2310.57 1459.58 2310.57 1468.33 Q2310.57 1477.06 2307.49 1481.67 Q2304.44 1486.25 2298.63 1486.25 Q2292.82 1486.25 2289.74 1481.67 Q2286.68 1477.06 2286.68 1468.33 Q2286.68 1459.58 2289.74 1455 Q2292.82 1450.39 2298.63 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M2328.79 1454.1 Q2325.18 1454.1 2323.35 1457.66 Q2321.54 1461.2 2321.54 1468.33 Q2321.54 1475.44 2323.35 1479.01 Q2325.18 1482.55 2328.79 1482.55 Q2332.42 1482.55 2334.23 1479.01 Q2336.06 1475.44 2336.06 1468.33 Q2336.06 1461.2 2334.23 1457.66 Q2332.42 1454.1 2328.79 1454.1 M2328.79 1450.39 Q2334.6 1450.39 2337.65 1455 Q2340.73 1459.58 2340.73 1468.33 Q2340.73 1477.06 2337.65 1481.67 Q2334.6 1486.25 2328.79 1486.25 Q2322.98 1486.25 2319.9 1481.67 Q2316.84 1477.06 2316.84 1468.33 Q2316.84 1459.58 2319.9 1455 Q2322.98 1450.39 2328.79 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M1298.37 1532.4 L1285.47 1549.74 L1299.03 1568.04 L1292.13 1568.04 L1281.75 1554.04 L1271.37 1568.04 L1264.47 1568.04 L1278.31 1549.39 L1265.65 1532.4 L1272.55 1532.4 L1282.01 1545.1 L1291.46 1532.4 L1298.37 1532.4 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip872)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  210.746,1403.96 2352.76,1403.96 
  "/>
<polyline clip-path="url(#clip872)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  210.746,962.084 2352.76,962.084 
  "/>
<polyline clip-path="url(#clip872)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  210.746,520.211 2352.76,520.211 
  "/>
<polyline clip-path="url(#clip872)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  210.746,78.3372 2352.76,78.3372 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  210.746,1423.18 210.746,47.2441 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  210.746,1403.96 229.644,1403.96 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  210.746,962.084 229.644,962.084 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  210.746,520.211 229.644,520.211 
  "/>
<polyline clip-path="url(#clip870)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  210.746,78.3372 229.644,78.3372 
  "/>
<path clip-path="url(#clip870)" d="M114.26 1404.41 L143.936 1404.41 L143.936 1408.34 L114.26 1408.34 L114.26 1404.41 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M154.839 1417.3 L162.477 1417.3 L162.477 1390.94 L154.167 1392.6 L154.167 1388.34 L162.431 1386.68 L167.107 1386.68 L167.107 1417.3 L174.746 1417.3 L174.746 1421.24 L154.839 1421.24 L154.839 1417.3 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M162.802 947.883 Q159.19 947.883 157.362 951.448 Q155.556 954.989 155.556 962.119 Q155.556 969.225 157.362 972.79 Q159.19 976.332 162.802 976.332 Q166.436 976.332 168.241 972.79 Q170.07 969.225 170.07 962.119 Q170.07 954.989 168.241 951.448 Q166.436 947.883 162.802 947.883 M162.802 944.179 Q168.612 944.179 171.667 948.786 Q174.746 953.369 174.746 962.119 Q174.746 970.846 171.667 975.452 Q168.612 980.035 162.802 980.035 Q156.991 980.035 153.913 975.452 Q150.857 970.846 150.857 962.119 Q150.857 953.369 153.913 948.786 Q156.991 944.179 162.802 944.179 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M154.839 533.555 L162.477 533.555 L162.477 507.19 L154.167 508.857 L154.167 504.597 L162.431 502.931 L167.107 502.931 L167.107 533.555 L174.746 533.555 L174.746 537.491 L154.839 537.491 L154.839 533.555 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M158.427 91.6821 L174.746 91.6821 L174.746 95.6172 L152.802 95.6172 L152.802 91.6821 Q155.464 88.9274 160.047 84.2978 Q164.653 79.6451 165.834 78.3025 Q168.079 75.7794 168.959 74.0433 Q169.862 72.284 169.862 70.5942 Q169.862 67.8396 167.917 66.1035 Q165.996 64.3674 162.894 64.3674 Q160.695 64.3674 158.241 65.1313 Q155.811 65.8952 153.033 67.4461 L153.033 62.7239 Q155.857 61.5896 158.311 61.0109 Q160.765 60.4322 162.802 60.4322 Q168.172 60.4322 171.366 63.1174 Q174.561 65.8026 174.561 70.2933 Q174.561 72.4229 173.751 74.3442 Q172.964 76.2423 170.857 78.8349 Q170.278 79.5062 167.177 82.7238 Q164.075 85.9182 158.427 91.6821 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip870)" d="M67.3143 733.525 Q73.68 736.008 75.6216 738.363 Q77.5631 740.718 77.5631 744.665 L77.5631 749.344 L72.6615 749.344 L72.6615 745.906 Q72.6615 743.487 71.5157 742.151 Q70.3699 740.814 66.1048 739.191 L63.4312 738.14 L28.3562 752.559 L28.3562 746.352 L56.238 735.212 L28.3562 724.072 L28.3562 717.865 L67.3143 733.525 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><circle clip-path="url(#clip872)" cx="271.369" cy="862.19" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="291.577" cy="949.537" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="311.784" cy="805.336" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="331.992" cy="750.924" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="352.199" cy="680.493" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="372.407" cy="810.962" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="392.615" cy="673.815" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="412.822" cy="699.108" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="433.03" cy="452.113" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="453.238" cy="549.436" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="473.445" cy="599.467" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="493.653" cy="716.003" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="513.861" cy="469.439" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="534.068" cy="444.525" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="554.276" cy="435.362" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="574.483" cy="554.456" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="594.691" cy="439.966" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="614.899" cy="454.572" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="635.106" cy="507.39" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="655.314" cy="501.54" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="675.522" cy="578.411" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="695.729" cy="471.929" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="715.937" cy="677.833" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="736.145" cy="451.448" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="756.352" cy="550.036" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="776.56" cy="543.352" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="796.768" cy="656.997" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="816.975" cy="794.361" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="837.183" cy="723.563" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="857.39" cy="712.903" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="877.598" cy="690.399" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="897.806" cy="615.211" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="918.013" cy="876.827" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="938.221" cy="987.887" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="958.429" cy="916.985" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="978.636" cy="843.543" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="998.844" cy="1004.6" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1019.05" cy="888.949" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1039.26" cy="824.688" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1059.47" cy="1313.26" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1079.67" cy="1133.8" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1099.88" cy="1322.53" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1120.09" cy="1067.5" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1140.3" cy="1181.37" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1160.51" cy="1221.55" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1180.71" cy="1187.37" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1200.92" cy="1384.24" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1221.13" cy="1263.88" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1241.34" cy="1339.46" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1261.54" cy="1111.83" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1281.75" cy="1200.54" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1301.96" cy="1220.93" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1322.17" cy="1101.91" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1342.37" cy="1000.95" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1362.58" cy="1305.17" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1382.79" cy="1040.84" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1403" cy="1093.21" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1423.2" cy="984.651" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1443.41" cy="945.887" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1463.62" cy="939.724" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1483.83" cy="840.266" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1504.03" cy="769.641" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1524.24" cy="705.017" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1544.45" cy="744.433" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1564.66" cy="555.762" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1584.87" cy="550.124" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1605.07" cy="481.648" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1625.28" cy="432.864" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1645.49" cy="393.762" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1665.7" cy="406.194" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1685.9" cy="436.53" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1706.11" cy="507.494" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1726.32" cy="346.316" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1746.53" cy="194.686" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1766.73" cy="286.536" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1786.94" cy="293.917" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1807.15" cy="94.7153" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1827.36" cy="345.861" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1847.56" cy="198.42" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1867.77" cy="86.1857" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1887.98" cy="137.646" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1908.19" cy="284.173" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1928.4" cy="93.7747" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1948.6" cy="179.517" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1968.81" cy="294.975" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="1989.02" cy="167.167" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2009.23" cy="285.751" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2029.43" cy="343.838" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2049.64" cy="225.508" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2069.85" cy="322.73" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2090.06" cy="403.817" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2110.26" cy="525.891" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2130.47" cy="481.754" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2150.68" cy="574.889" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2170.89" cy="375.164" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2191.09" cy="592.763" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2211.3" cy="435.524" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2231.51" cy="806.27" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2251.72" cy="778.752" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2271.93" cy="730.83" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
<circle clip-path="url(#clip872)" cx="2292.13" cy="653.656" r="7.2" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="0"/>
</svg>
<p>We&#39;ll fit this using a simple polynomial regression model:</p><p class="math-container">\[\begin{aligned}
\sigma &amp;\sim \text{Half-Normal}(\mu=0, \sigma=1)\\
\alpha, \beta_j &amp;\sim \mathrm{Normal}(\mu=0, \sigma=1)\\
\hat{y}_i &amp;= \alpha + \sum_{j=1}^J x_i^j \beta_j\\
y_i &amp;\sim \mathrm{Normal}(\mu=\hat{y}_i, \sigma=\sigma)
\end{aligned}\]</p><p>We just need to implement the log-density function of the resulting posterior.</p><pre><code class="language-julia hljs">struct RegressionProblem{X,Z,Y}
    x::X
    J::Int
    z::Z
    y::Y
end
function RegressionProblem(x, J, y)
    z = x .* (1:J)&#39;
    return RegressionProblem(x, J, z, y)
end

function (prob::RegressionProblem)(θ)
    σ = θ.σ
    α = θ.α
    β = θ.β
    z = prob.z
    y = prob.y
    lp = normlogpdf(σ) + logtwo
    lp += normlogpdf(α)
    lp += sum(normlogpdf, β)
    y_hat = muladd(z, β, α)
    lp += sum(eachindex(y_hat, y)) do i
        return normlogpdf(y_hat[i], σ, y[i])
    end
    return lp
end

J = 3
dim = J + 2
model = RegressionProblem(x, J, y)
ndraws = 1_000;</code></pre><h2 id="DynamicHMC.jl"><a class="docs-heading-anchor" href="#DynamicHMC.jl">DynamicHMC.jl</a><a id="DynamicHMC.jl-1"></a><a class="docs-heading-anchor-permalink" href="#DynamicHMC.jl" title="Permalink"></a></h2><p>To use DynamicHMC, we first need to transform our model to an unconstrained space using <a href="https://tamaspapp.eu/TransformVariables.jl/stable/">TransformVariables.jl</a> and wrap it in a type that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface:</p><pre><code class="language-julia hljs">using DynamicHMC, LogDensityProblems, TransformVariables

transform = as((σ=asℝ₊, α=asℝ, β=as(Array, J)))
P = TransformedLogDensity(transform, model)
∇P = ADgradient(:ForwardDiff, P)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ForwardDiff AD wrapper for TransformedLogDensity of dimension 5, w/ chunk size 5</code></pre><p>Pathfinder, on the other hand, expects a log-density function:</p><pre><code class="language-julia hljs">logp(x) = LogDensityProblems.logdensity(P, x)
∇logp(x) = LogDensityProblems.logdensity_and_gradient(∇P, x)[2]
result_pf = pathfinder(logp, ∇logp; dim)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Single-path Pathfinder result
  tries: 2
  draws: 5
  fit iteration: 22 (total: 30)
  fit ELBO: -117.74 ± 0.25
  fit distribution: Distributions.MvNormal{Float64, Pathfinder.WoodburyPDMat{Float64, LinearAlgebra.Diagonal{Float64, Vector{Float64}}, Matrix{Float64}, Matrix{Float64}, LinearAlgebra.Diagonal{Float64, Vector{Float64}}, LinearAlgebra.QRCompactWYQ{Float64, Matrix{Float64}}, LinearAlgebra.UpperTriangular{Float64, Matrix{Float64}}}, Vector{Float64}}(
dim: 5
μ: [-0.351938851773518, 0.24689540392550613, 0.05827742217490308, 0.11655069217591063, 0.17482994194820867]
Σ: [0.005794060117888708 0.004501772414217777 … 0.005154335534465927 -0.004280279761853394; 0.004501772414217777 0.03531824833492471 … 0.007991672055998154 -0.017293830014585607; … ; 0.005154335534465927 0.007991672055998154 … 0.7015097471184754 -0.440833068526388; -0.004280279761853394 -0.017293830014585607 … -0.440833068526388 0.28326699991508697]
)
</code></pre><pre><code class="language-julia hljs">init_params = result_pf.draws[:, 1]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 -0.3490992268968827
  0.1768169119835949
  0.1570690692732149
 -0.25930709446876066
  0.4601383974449641</code></pre><pre><code class="language-julia hljs">inv_metric = result_pf.fit_distribution.Σ</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×5 Pathfinder.WoodburyPDMat{Float64, LinearAlgebra.Diagonal{Float64, Vector{Float64}}, Matrix{Float64}, Matrix{Float64}, LinearAlgebra.Diagonal{Float64, Vector{Float64}}, LinearAlgebra.QRCompactWYQ{Float64, Matrix{Float64}}, LinearAlgebra.UpperTriangular{Float64, Matrix{Float64}}}:
  0.00579406   0.00450177  -0.00167075   0.00515434  -0.00428028
  0.00450177   0.0353182   -0.00747888   0.00799167  -0.0172938
 -0.00167075  -0.00747888   0.0168776   -0.0892416    0.0570341
  0.00515434   0.00799167  -0.0892416    0.70151     -0.440833
 -0.00428028  -0.0172938    0.0570341   -0.440833     0.283267</code></pre><h3 id="Initializing-from-Pathfinder&#39;s-draws"><a class="docs-heading-anchor" href="#Initializing-from-Pathfinder&#39;s-draws">Initializing from Pathfinder&#39;s draws</a><a id="Initializing-from-Pathfinder&#39;s-draws-1"></a><a class="docs-heading-anchor-permalink" href="#Initializing-from-Pathfinder&#39;s-draws" title="Permalink"></a></h3><p>Here we just need to pass one of the draws as the initial point <code>q</code>:</p><pre><code class="language-julia hljs">result_dhmc1 = mcmc_with_warmup(
    Random.GLOBAL_RNG,
    ∇P,
    ndraws;
    initialization=(; q=init_params),
    reporter=NoProgressReport(),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(chain = [[-0.3054824878530329, 0.26716149034039127, 0.7272689968468079, 0.2224486380659594, -0.1084255831324917], [-0.2908467858510639, 0.19167155361676114, 1.1406365409260684, 0.14758964884858555, -0.1893670281139442], [-0.34380945343229175, 0.29942215184083626, -0.5777824599114699, -0.6436287965429913, 0.8855090720222333], [-0.3841685466201196, 0.298174614226367, -0.8075365335489764, -0.8012813635146329, 1.0430495860586186], [-0.3078946717468547, 0.1449226032162257, 0.966474834432309, 1.1756039883046019, -0.7675640485149511], [-0.4098788448240356, 0.2800277635593168, 1.1373781866199255, 0.8297890464051306, -0.6656931424880262], [-0.28296609351271146, 0.1399317686644654, -0.6466329049508028, -0.48956010944986833, 0.8480265722438117], [-0.3484255190604426, 0.4504492370598197, -0.6315922138596126, -0.4015110802255826, 0.6332081316466722], [-0.3747347856309989, 0.5472993824076655, -0.37225248010847106, 0.1024349049883511, 0.15244430259053593], [-0.3300313853900508, 0.46284215429419595, 0.1874576267346407, 1.3378385817088472, -0.8083618954078022]  …  [-0.31072635481228855, 0.20843508356383786, -0.29619040772947697, 0.1594231315281357, 0.24332667433800123], [-0.39974129011056325, 0.3637468122811537, 0.4933883462994535, -0.3787207012871011, 0.2651944597766067], [-0.3542558369945796, 0.1495449158925911, 0.8517267638270553, 0.2785576452489584, -0.17457112429855806], [-0.1853801381895988, 0.23896740322195176, 0.22996644753240914, 0.45103705737965505, -0.12854476831105335], [-0.3402471311415508, 0.20837227343479497, 0.6997160004775824, -0.3685188026143038, 0.295033514448492], [-0.4078770616352019, 0.22757752082219623, 0.9679549801607268, 0.07750776502403585, -0.058761358208542516], [-0.2361153382432716, 0.02967011762316478, -0.9934006020057146, 1.0904793194213718, -0.0063575051995702694], [-0.49946058746542576, 0.31720230291547447, -1.2365164441760672, 1.4512891585712568, -0.2873856503848051], [-0.21479342697125292, 0.3856930954891587, -1.242743645322185, 0.7083792209059254, 0.18000632998117008], [-0.1523994901923122, 0.38159343778183635, -1.0682894335107957, 0.8244042197978011, 0.05364026627825244]], tree_statistics = DynamicHMC.TreeStatisticsNUTS[DynamicHMC.TreeStatisticsNUTS(-114.15400794126327, 6, turning at positions -19:44, 0.9492141091360732, 63, DynamicHMC.Directions(0xee0eb5ac)), DynamicHMC.TreeStatisticsNUTS(-116.9178695617601, 4, turning at positions -18:-21, 0.6815805736349873, 27, DynamicHMC.Directions(0x5a830266)), DynamicHMC.TreeStatisticsNUTS(-115.18440484050973, 6, turning at positions -63:-126, 0.9116318507184775, 127, DynamicHMC.Directions(0xdbb78201)), DynamicHMC.TreeStatisticsNUTS(-113.81474776521897, 5, turning at positions -23:8, 0.956538594557927, 31, DynamicHMC.Directions(0x032d8048)), DynamicHMC.TreeStatisticsNUTS(-115.75368493826885, 6, turning at positions -3:-66, 0.8388534632122178, 127, DynamicHMC.Directions(0x935ed1bd)), DynamicHMC.TreeStatisticsNUTS(-115.09668319549168, 6, turning at positions -16:47, 0.9597687648205017, 63, DynamicHMC.Directions(0x7307faaf)), DynamicHMC.TreeStatisticsNUTS(-114.80717267223568, 6, turning at positions -64:-127, 0.9551766204635971, 127, DynamicHMC.Directions(0xc3191b00)), DynamicHMC.TreeStatisticsNUTS(-114.90288512307714, 6, turning at positions -7:56, 0.9996478269889557, 63, DynamicHMC.Directions(0x7d7ef1f8)), DynamicHMC.TreeStatisticsNUTS(-115.91286730747049, 6, turning at positions 17:80, 0.9720161691638178, 127, DynamicHMC.Directions(0x0bf12850)), DynamicHMC.TreeStatisticsNUTS(-117.94794296381068, 6, turning at positions 44:75, 0.998250584541677, 127, DynamicHMC.Directions(0x43578b4b))  …  DynamicHMC.TreeStatisticsNUTS(-115.84642406135495, 6, turning at positions -3:60, 0.9991160380944365, 63, DynamicHMC.Directions(0x9e66917c)), DynamicHMC.TreeStatisticsNUTS(-113.73726930521377, 6, turning at positions -12:51, 0.9986240203269211, 63, DynamicHMC.Directions(0x9b931c33)), DynamicHMC.TreeStatisticsNUTS(-114.23850648162878, 6, turning at positions 44:107, 0.9999464446902606, 127, DynamicHMC.Directions(0x6f8cfeeb)), DynamicHMC.TreeStatisticsNUTS(-115.46375345569334, 6, turning at positions -42:21, 0.9985708208150224, 63, DynamicHMC.Directions(0xe3e72615)), DynamicHMC.TreeStatisticsNUTS(-116.01823423987909, 5, turning at positions 26:57, 0.9745804428838801, 63, DynamicHMC.Directions(0x3ecbc779)), DynamicHMC.TreeStatisticsNUTS(-114.69696701473379, 6, turning at positions -39:24, 0.9233080673302962, 63, DynamicHMC.Directions(0x441e7cd8)), DynamicHMC.TreeStatisticsNUTS(-117.35150530514632, 6, turning at positions -10:53, 0.8365132628991666, 63, DynamicHMC.Directions(0x6e0175b5)), DynamicHMC.TreeStatisticsNUTS(-120.4341963577804, 6, turning at positions -58:5, 0.7807080851860081, 63, DynamicHMC.Directions(0x56aeefc5)), DynamicHMC.TreeStatisticsNUTS(-119.26952539421957, 6, turning at positions -19:44, 0.9175398948981508, 63, DynamicHMC.Directions(0x7fb8ddec)), DynamicHMC.TreeStatisticsNUTS(-117.71739151900293, 5, turning at positions -16:15, 0.9749333614771457, 31, DynamicHMC.Directions(0x14e6300f))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.09863365582929956, 0.15308261911791746, 0.9057803227265346, 0.8931366390391907, 0.634247594940043], ϵ = 0.0464756012812803)</code></pre><h3 id="Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate"><a class="docs-heading-anchor" href="#Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate">Initializing metric adaptation from Pathfinder&#39;s estimate</a><a id="Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate-1"></a><a class="docs-heading-anchor-permalink" href="#Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate" title="Permalink"></a></h3><p>To start with Pathfinder&#39;s inverse metric estimate, we just need to initialize a <code>GaussianKineticEnergy</code> object with it as input: </p><pre><code class="language-julia hljs">result_dhmc2 = mcmc_with_warmup(
    Random.GLOBAL_RNG,
    ∇P,
    ndraws;
    initialization=(; q=init_params, κ=GaussianKineticEnergy(inv_metric)),
    warmup_stages=default_warmup_stages(; M=Symmetric),
    reporter=NoProgressReport(),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(chain = [[-0.3478555505666078, 0.28566963155258573, -0.3039860088471689, 1.0425348049494092, -0.3555308301304248], [-0.22185683663029232, 0.44987978175707327, 0.17865687722681858, 1.0721116385526155, -0.5998436908188697], [-0.4275627363034338, 0.14361683914845055, 1.0320557673162785, -0.5048875866654339, 0.3501546588520045], [-0.2702456386599849, 0.28441573303010637, -0.002696094146027894, -0.20402445336139563, 0.41357314219644126], [-0.2833595965939425, 0.0256630656375383, 0.637017086177275, -0.1820050432502558, 0.2514059608015887], [-0.28450497537571884, -0.011201377561718268, 0.6513942878393733, -1.581147009528575, 1.154528478463449], [-0.34719030641982745, 0.2643791617092923, -0.8771094859690602, 1.5835610150372124, -0.5166235869220701], [-0.35058282723605494, 0.2286480070972828, -0.954637566789732, 1.789968185865786, -0.6294809876579271], [-0.41922096664709696, 0.19548109878737857, -1.0188112056666514, 2.391484777332231, -0.9206766463689573], [-0.2623956652254095, 0.20747937136437108, 0.9066782684739545, 0.21293831301331612, -0.19005037646996936]  …  [-0.351329200130322, 0.4950808684205919, -0.3450549437791801, -0.5184460617820648, 0.6807383600006882], [-0.3079484725656924, 0.13787429032188514, -0.034651750606338155, 1.0633190795946417, -0.2841506919613282], [-0.4469767109078189, 0.29601977173316024, -0.4279501361966277, -0.23624817279527655, 0.4806349694374962], [-0.2226204917329171, 0.2512990850188788, 0.425832777587661, 1.4181425346176357, -0.8763536203553558], [-0.506825748619421, 0.21233175252574596, 0.41136652790129813, -0.5755032609483511, 0.492315082816813], [-0.22534637054262452, 0.0642804391235076, 1.7220568095136728, 1.036653925426104, -0.9059821645089774], [-0.5414696999799251, 0.37185070137131065, 0.30343988977766123, 0.6461351430637023, -0.3193459633453238], [-0.1998841270604209, 0.3213693693117637, 0.04306330123728934, -0.8670242380920774, 0.7173226312203658], [-0.26858461045785176, 0.048366934836505004, 0.6174936813509027, -0.1408390698225323, 0.2602191875391492], [-0.4028089613408873, 0.2604766866705982, 1.9695852026938778, 0.23330230475946687, -0.5728869638597195]], tree_statistics = DynamicHMC.TreeStatisticsNUTS[DynamicHMC.TreeStatisticsNUTS(-118.56993104809891, 3, turning at positions -8:-15, 0.9711476230784627, 15, DynamicHMC.Directions(0x49cc5380)), DynamicHMC.TreeStatisticsNUTS(-115.62562402915223, 3, turning at positions -2:5, 0.9361573929581903, 7, DynamicHMC.Directions(0x57018535)), DynamicHMC.TreeStatisticsNUTS(-118.24500914422634, 4, turning at positions -5:10, 0.9339690341311649, 15, DynamicHMC.Directions(0xa567683a)), DynamicHMC.TreeStatisticsNUTS(-114.65982630093585, 3, turning at positions -1:6, 0.9998476500173276, 7, DynamicHMC.Directions(0xb24e0c7e)), DynamicHMC.TreeStatisticsNUTS(-116.22533062903369, 3, turning at positions 8:15, 0.8588765589715973, 15, DynamicHMC.Directions(0xf6e488ff)), DynamicHMC.TreeStatisticsNUTS(-121.74724173897434, 4, turning at positions -2:13, 0.7422045102800061, 15, DynamicHMC.Directions(0xd89bff6d)), DynamicHMC.TreeStatisticsNUTS(-120.93513267799209, 4, turning at positions -8:7, 0.8868079654721653, 15, DynamicHMC.Directions(0xee38b517)), DynamicHMC.TreeStatisticsNUTS(-114.87215632279755, 2, turning at positions -1:2, 0.9601844524852932, 3, DynamicHMC.Directions(0xc02e73ce)), DynamicHMC.TreeStatisticsNUTS(-117.31851866456596, 2, turning at positions -3:0, 0.955130816893394, 3, DynamicHMC.Directions(0xeba57e10)), DynamicHMC.TreeStatisticsNUTS(-118.20932600513287, 3, turning at positions -3:4, 0.9999999999999999, 7, DynamicHMC.Directions(0xf8c42e1c))  …  DynamicHMC.TreeStatisticsNUTS(-117.05744000809719, 3, turning at positions -5:2, 0.9443567252059699, 7, DynamicHMC.Directions(0x3fb2bb42)), DynamicHMC.TreeStatisticsNUTS(-116.44443878962747, 3, turning at positions 0:7, 0.9972231992278049, 7, DynamicHMC.Directions(0x09e6681f)), DynamicHMC.TreeStatisticsNUTS(-118.42888402614437, 4, turning at positions -13:-20, 0.9474502168687965, 23, DynamicHMC.Directions(0x91f1c863)), DynamicHMC.TreeStatisticsNUTS(-116.73421844206871, 3, turning at positions -6:1, 0.9999999999999999, 7, DynamicHMC.Directions(0x4963f4c9)), DynamicHMC.TreeStatisticsNUTS(-118.95146133463368, 3, turning at positions -2:5, 0.9692460510549324, 7, DynamicHMC.Directions(0x7121029d)), DynamicHMC.TreeStatisticsNUTS(-119.56225775502568, 3, turning at positions -7:0, 0.9555597764482696, 7, DynamicHMC.Directions(0x53deb340)), DynamicHMC.TreeStatisticsNUTS(-121.80877402366072, 3, turning at positions -3:4, 0.8707498553160775, 7, DynamicHMC.Directions(0xa562e52c)), DynamicHMC.TreeStatisticsNUTS(-120.70797896307177, 3, turning at positions 0:7, 0.7064837640449765, 7, DynamicHMC.Directions(0xff4e1b27)), DynamicHMC.TreeStatisticsNUTS(-119.92388382667359, 2, turning at positions 4:7, 0.8596857735724966, 7, DynamicHMC.Directions(0xee376217)), DynamicHMC.TreeStatisticsNUTS(-118.8729221334817, 3, turning at positions -6:1, 0.905660486828216, 7, DynamicHMC.Directions(0x55692ba1))], κ = Gaussian kinetic energy (Symmetric), √diag(M⁻¹): [0.10173204300119906, 0.16300048737347342, 0.8343790775645613, 0.8723728615869799, 0.6369961761293935], ϵ = 0.3600881646105259)</code></pre><p>We also specified that DynamicHMC should tune a dense <code>Symmetric</code> matrix. However, we could also have requested a <code>Diagonal</code> metric.</p><h3 id="Use-Pathfinder&#39;s-metric-estimate-for-sampling"><a class="docs-heading-anchor" href="#Use-Pathfinder&#39;s-metric-estimate-for-sampling">Use Pathfinder&#39;s metric estimate for sampling</a><a id="Use-Pathfinder&#39;s-metric-estimate-for-sampling-1"></a><a class="docs-heading-anchor-permalink" href="#Use-Pathfinder&#39;s-metric-estimate-for-sampling" title="Permalink"></a></h3><p>To turn off metric adaptation entirely and use Pathfinder&#39;s estimate, we just set the number and size of the metric adaptation windows to 0.</p><pre><code class="language-julia hljs">result_dhmc3 = mcmc_with_warmup(
    Random.GLOBAL_RNG,
    ∇P,
    ndraws;
    initialization=(; q=init_params, κ=GaussianKineticEnergy(inv_metric)),
    warmup_stages=default_warmup_stages(; middle_steps=0, doubling_stages=0),
    reporter=NoProgressReport(),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(chain = [[-0.39683387911064644, 0.21261091838036572, 1.649852267628158, 0.028639232283564575, -0.2737661987080747], [-0.3369522523644598, 0.15131180260475655, 1.6256337628924247, 0.23870110149759882, -0.3826465723834686], [-0.36399494531671595, 0.12185994187016666, 0.15823884113922107, -0.6159600696478875, 0.686541263624796], [-0.2973182044114633, 0.3145005024420015, 0.0342064811358615, -0.16226698628404101, 0.3707809369636861], [-0.3747852338280996, 0.2618889043932082, 0.06975746024772049, -0.7180316007480979, 0.6837658713782979], [-0.20422889189207089, 0.3388379979467472, -0.06632789357308183, 0.4527003480058096, -0.11224311939613996], [-0.46007989340043176, 0.24074469403675505, 0.09245729320311394, -1.7536907135685347, 1.4246137495993225], [-0.2955056710658137, 0.5619234575561873, 0.536890497816221, -1.4352332220963433, 0.8754079777148333], [-0.34048469357559685, 0.34510614513999066, 0.00032298501632761767, 1.5519254917816303, -0.7422465037732703], [-0.3072630537176072, 0.3586988661801939, -0.09820218513455373, 2.4269621055479083, -1.2936871507119925]  …  [-0.3961234071449033, 0.20440109043154747, -0.7931056721619909, -0.059771607882957434, 0.6343528985421092], [-0.4106178514589018, 0.1924418169474951, -0.2784891364608879, -0.10472516511391322, 0.5112245532366781], [-0.2928099883289504, 0.2982430373041121, -0.5317417647164664, 0.24631632580812018, 0.20828307694212692], [-0.3469737030050967, -0.01798720139879189, -0.704923523342237, 1.683078292867254, -0.595357816920409], [-0.3015537062383372, 0.301886629406356, -0.6998530489795854, 1.349298063231379, -0.4791961886938798], [-0.40676314352622406, 0.1796150756868471, -0.6084510739820705, 0.6622987529099778, 0.1008875871742474], [-0.4255346020480816, 0.14852596552786568, -0.6915540744441869, 1.5129334287397582, -0.40202440437542053], [-0.27777629587394775, 0.19419449479078726, -0.5644049543029475, 0.4739365290698788, 0.18924969681922502], [-0.3990290870379156, 0.16689571852963642, -0.46781746039975497, -0.17799619170222153, 0.588019623396568], [-0.31321042641131397, 0.3649251386635836, -0.4892824987894493, -0.6611111805728146, 0.7960637794147192]], tree_statistics = DynamicHMC.TreeStatisticsNUTS[DynamicHMC.TreeStatisticsNUTS(-114.5218219401649, 5, turning at positions -21:-28, 0.9349363604738509, 39, DynamicHMC.Directions(0xffa5db0b)), DynamicHMC.TreeStatisticsNUTS(-115.11964990543144, 2, turning at positions 3:6, 0.9497645076059891, 7, DynamicHMC.Directions(0xa87bbb06)), DynamicHMC.TreeStatisticsNUTS(-115.68496853978448, 5, turning at positions 6:9, 0.881556390035262, 39, DynamicHMC.Directions(0x5af6e2a1)), DynamicHMC.TreeStatisticsNUTS(-113.40533554303035, 2, turning at positions -2:-5, 0.983610763409562, 7, DynamicHMC.Directions(0xad135812)), DynamicHMC.TreeStatisticsNUTS(-114.10455392741449, 3, turning at positions -4:3, 0.9843420369512524, 7, DynamicHMC.Directions(0x837f30b3)), DynamicHMC.TreeStatisticsNUTS(-115.62335520147963, 3, turning at positions -3:4, 0.9354351228743182, 7, DynamicHMC.Directions(0xe14b241c)), DynamicHMC.TreeStatisticsNUTS(-119.14727283273962, 3, turning at positions -4:3, 0.9230801676524945, 7, DynamicHMC.Directions(0xac5fa86b)), DynamicHMC.TreeStatisticsNUTS(-120.0426252436489, 4, turning at positions -24:-27, 0.8938586427111181, 31, DynamicHMC.Directions(0xb2970dc4)), DynamicHMC.TreeStatisticsNUTS(-118.8049452697508, 4, turning at positions -5:-12, 0.9487082096123871, 23, DynamicHMC.Directions(0x6e71932b)), DynamicHMC.TreeStatisticsNUTS(-118.79699921960899, 2, turning at positions -1:2, 0.9028367258297801, 3, DynamicHMC.Directions(0x8797ce12))  …  DynamicHMC.TreeStatisticsNUTS(-114.82668694371746, 3, turning at positions 4:11, 0.9958232635119982, 15, DynamicHMC.Directions(0x958011eb)), DynamicHMC.TreeStatisticsNUTS(-114.98389145167263, 4, turning at positions -10:-17, 0.9744387377213863, 31, DynamicHMC.Directions(0xeaede30e)), DynamicHMC.TreeStatisticsNUTS(-115.05013841282998, 4, turning at positions 13:20, 0.9823322549414238, 31, DynamicHMC.Directions(0xc1fba834)), DynamicHMC.TreeStatisticsNUTS(-120.58337819095038, 3, turning at positions -2:5, 0.5987252395694135, 7, DynamicHMC.Directions(0x9488cb85)), DynamicHMC.TreeStatisticsNUTS(-120.78580582581598, 2, turning at positions -2:1, 0.9436877524785291, 3, DynamicHMC.Directions(0xfcf3fd71)), DynamicHMC.TreeStatisticsNUTS(-116.88288491999558, 3, turning at positions -7:0, 0.9373486418967395, 7, DynamicHMC.Directions(0x64aacbf8)), DynamicHMC.TreeStatisticsNUTS(-115.71986295964369, 2, turning at positions -2:1, 0.8948699638714143, 3, DynamicHMC.Directions(0x2dfd1a61)), DynamicHMC.TreeStatisticsNUTS(-115.89436745505223, 3, turning at positions -4:3, 0.9999999999999999, 7, DynamicHMC.Directions(0x841a23e3)), DynamicHMC.TreeStatisticsNUTS(-114.2925972339488, 3, turning at positions -2:5, 0.9718344330825597, 7, DynamicHMC.Directions(0x4ebb118d)), DynamicHMC.TreeStatisticsNUTS(-114.3777494811507, 3, turning at positions -1:6, 0.9731345279058424, 7, DynamicHMC.Directions(0x5298bf5e))], κ = Gaussian kinetic energy (WoodburyPDMat), √diag(M⁻¹): [0.07611872383250201, 0.1879314990493204, 0.12991366130961352, 0.8375617870452757, 0.5322283343782884], ϵ = 0.575723400288863)</code></pre><h2 id="AdvancedHMC.jl"><a class="docs-heading-anchor" href="#AdvancedHMC.jl">AdvancedHMC.jl</a><a id="AdvancedHMC.jl-1"></a><a class="docs-heading-anchor-permalink" href="#AdvancedHMC.jl" title="Permalink"></a></h2><p>Similar to Pathfinder, AdvancedHMC works with an unconstrained log density function and its gradient. We&#39;ll just use the <code>logp</code> we already created above.</p><pre><code class="language-julia hljs">using AdvancedHMC, ForwardDiff

nadapts = 500;</code></pre><h3 id="Initializing-from-Pathfinder&#39;s-draws-2"><a class="docs-heading-anchor" href="#Initializing-from-Pathfinder&#39;s-draws-2">Initializing from Pathfinder&#39;s draws</a><a class="docs-heading-anchor-permalink" href="#Initializing-from-Pathfinder&#39;s-draws-2" title="Permalink"></a></h3><pre><code class="language-julia hljs">metric = DiagEuclideanMetric(dim)
hamiltonian = Hamiltonian(metric, logp, ForwardDiff)
ϵ = find_good_stepsize(hamiltonian, init_params)
integrator = Leapfrog(ϵ)
proposal = NUTS{MultinomialTS,GeneralisedNoUTurn}(integrator)
adaptor = StepSizeAdaptor(0.8, integrator)
samples_ahmc1, stats_ahmc1 = sample(
    hamiltonian,
    proposal,
    init_params,
    ndraws + nadapts,
    adaptor,
    nadapts;
    drop_warmup=true,
    progress=false,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([[-0.4557125747014714, 0.3800811624648083, 0.20588235867220994, 0.944676327711183, -0.4895782484084552], [-0.32188377954073605, 0.1966630780231436, 1.7361222025997571, -0.5622301123439412, 0.12419121259678886], [-0.38165468089350374, 0.22819217940502173, -1.6410238525758554, 0.6072018705249415, 0.392617508160418], [-0.39031876021534556, 0.17456735923002575, 0.9699870962981474, 0.8646104053802012, -0.6395368570020058], [-0.3096267334303175, 0.3675467461935805, 1.2382632612643232, 0.981969806669796, -0.844509849256731], [-0.3328313624292043, 0.2299826829201351, 1.0255212783799672, 0.031558250583390124, -0.09896955214997377], [-0.34011972248884775, 0.2508887367512747, -0.20698385943315817, -0.19779524163063614, 0.4547423812958876], [-0.3183663328389485, 0.18624161606563172, 0.5279133815846998, -0.9291535783080609, 0.7071317778375632], [-0.4061065213087101, 0.2514500401754386, -0.6299982235358463, 0.678697908147238, 0.00041663228770184857], [-0.3972864304954393, 0.18261992870363405, -1.205893044136493, -0.3073738785717701, 0.8457394488294806]  …  [-0.24089545059158818, 0.2170478753348015, 0.8719409574253997, -0.025610522682334796, -0.05593347026206534], [-0.4437530119250252, 0.15991444661698448, 0.5395185180835463, 0.02957839659487431, 0.1255977111189483], [-0.3966625763764024, -0.003987547027473087, 0.5873429677731457, 0.027805240070837466, 0.16614649087219974], [-0.20308496700598877, 0.05250742125247225, 0.5390509573656216, -0.01610066771022998, 0.1598930771631481], [-0.3405547562186738, 0.44355280601785674, 0.482591429545155, -0.7340228580152927, 0.4641481920869318], [-0.31110354639451465, 0.39156831616269866, -0.49023985066454523, 1.3623077900763778, -0.5894885795482079], [-0.37604881050722405, 0.27702860438467525, 1.3297595786253122, -1.0000232881740503, 0.4456650710703916], [-0.4113698650114672, 0.2722886123382378, 0.41276995474309985, -0.9971572721597032, 0.7847063007643795], [-0.2891652633616807, 0.2606548497268888, 0.37963138911706545, -0.8470666238926112, 0.6853265312499105], [-0.35912216072109, 0.19871862119330214, 0.1433382330963086, -0.9807843550497678, 0.8458222902409583]], NamedTuple[(n_steps = 15, is_accept = true, acceptance_rate = 0.9387228768550275, log_density = -114.38316082423728, hamiltonian_energy = 116.46568256833767, hamiltonian_energy_error = -0.5161357856851083, max_hamiltonian_energy_error = 0.5321203250069857, tree_depth = 3, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9586569507142394, log_density = -114.1417474906836, hamiltonian_energy = 116.69997063827982, hamiltonian_energy_error = 0.03529876131021581, max_hamiltonian_energy_error = 0.19673331807753414, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.982633477123841, log_density = -114.06957592484234, hamiltonian_energy = 115.4435510798974, hamiltonian_energy_error = 0.029354821344711013, max_hamiltonian_energy_error = -0.12956882034316664, tree_depth = 7, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.6067026949871018, log_density = -114.15720323800406, hamiltonian_energy = 117.32494096759706, hamiltonian_energy_error = 0.13999508386672233, max_hamiltonian_energy_error = 1.4182418737418203, tree_depth = 7, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 31, is_accept = true, acceptance_rate = 0.9959322359444048, log_density = -114.22495669443742, hamiltonian_energy = 116.33733770982907, hamiltonian_energy_error = -0.3173435669962572, max_hamiltonian_energy_error = -0.41153034808357347, tree_depth = 4, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.959350496204626, log_density = -112.70214130748242, hamiltonian_energy = 116.06436692973182, hamiltonian_energy_error = -0.02977606465321969, max_hamiltonian_energy_error = 0.1468216543184866, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 73, is_accept = true, acceptance_rate = 0.7223324549767951, log_density = -112.28541329119666, hamiltonian_energy = 113.84767571030602, hamiltonian_energy_error = -0.01434655661566353, max_hamiltonian_energy_error = 0.7718228134312142, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.8075341728737518, log_density = -113.49529222710524, hamiltonian_energy = 114.84759503371538, hamiltonian_energy_error = 0.20963179285229216, max_hamiltonian_energy_error = 0.534631515396498, tree_depth = 5, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 55, is_accept = true, acceptance_rate = 0.9840911392171637, log_density = -113.03439308689373, hamiltonian_energy = 115.63416700576667, hamiltonian_energy_error = -0.10851682549397879, max_hamiltonian_energy_error = -0.23215893203325777, tree_depth = 5, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.7763425508749321, log_density = -114.94607629173555, hamiltonian_energy = 115.45384718025423, hamiltonian_energy_error = 0.6499272915881704, max_hamiltonian_energy_error = 0.6499272915881704, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false)  …  (n_steps = 127, is_accept = true, acceptance_rate = 0.6137502639149606, log_density = -114.79095038083123, hamiltonian_energy = 115.98935720010469, hamiltonian_energy_error = 0.7364571243075915, max_hamiltonian_energy_error = 1.2373896117227758, tree_depth = 7, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 31, is_accept = true, acceptance_rate = 0.7909148620001354, log_density = -113.37391572380876, hamiltonian_energy = 116.20483890532464, hamiltonian_energy_error = -1.0293704075850485, max_hamiltonian_energy_error = 1.1222806364637137, tree_depth = 4, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.5457725482895344, log_density = -114.32963638684039, hamiltonian_energy = 117.46809643219626, hamiltonian_energy_error = 0.19658065884941323, max_hamiltonian_energy_error = 1.0362298431042802, tree_depth = 2, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.8934679878980039, log_density = -115.32572585186851, hamiltonian_energy = 116.06818935917528, hamiltonian_energy_error = 0.25800696898700437, max_hamiltonian_energy_error = 0.25800696898700437, tree_depth = 3, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.9834802510804878, log_density = -114.02008732458982, hamiltonian_energy = 116.38642465169609, hamiltonian_energy_error = -0.1643736168790184, max_hamiltonian_energy_error = -0.3837939822414427, tree_depth = 5, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.9475823402256733, log_density = -114.52940048864701, hamiltonian_energy = 115.35864727507843, hamiltonian_energy_error = 0.06048267567554433, max_hamiltonian_energy_error = 0.22665528238960064, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 79, is_accept = true, acceptance_rate = 0.990706526152731, log_density = -114.01231875761697, hamiltonian_energy = 116.22339963430446, hamiltonian_energy_error = -0.06912001923353728, max_hamiltonian_energy_error = -0.26529061829197076, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9974936205935787, log_density = -113.3294102220404, hamiltonian_energy = 115.076064572479, hamiltonian_energy_error = -0.1734750284756501, max_hamiltonian_energy_error = -0.18084483432775755, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 23, is_accept = true, acceptance_rate = 0.982047597732999, log_density = -113.18948247707681, hamiltonian_energy = 113.7333623682615, hamiltonian_energy_error = 0.043338697271138926, max_hamiltonian_energy_error = 0.05077864215633099, tree_depth = 4, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.6930462271180139, log_density = -113.95350383427703, hamiltonian_energy = 116.57223064408532, hamiltonian_energy_error = 0.19298680961878745, max_hamiltonian_energy_error = 1.1218245004761513, tree_depth = 6, numerical_error = false, step_size = 0.04066548196998231, nom_step_size = 0.04066548196998231, is_adapt = false)])</code></pre><h3 id="Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate-2"><a class="docs-heading-anchor" href="#Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate-2">Initializing metric adaptation from Pathfinder&#39;s estimate</a><a class="docs-heading-anchor-permalink" href="#Initializing-metric-adaptation-from-Pathfinder&#39;s-estimate-2" title="Permalink"></a></h3><p>We can&#39;t start with Pathfinder&#39;s inverse metric estimate directly. Instead we need to first extract its diagonal for a <code>DiagonalEuclideanMetric</code> or make it dense for a <code>DenseEuclideanMetric</code>:</p><pre><code class="language-julia hljs">metric = DenseEuclideanMetric(Matrix(inv_metric))
hamiltonian = Hamiltonian(metric, logp, ForwardDiff)
ϵ = find_good_stepsize(hamiltonian, init_params)
integrator = Leapfrog(ϵ)
proposal = NUTS{MultinomialTS,GeneralisedNoUTurn}(integrator)
adaptor = StepSizeAdaptor(0.8, integrator)
samples_ahmc2, stats_ahmc2 = sample(
    hamiltonian,
    proposal,
    init_params,
    ndraws + nadapts,
    adaptor,
    nadapts;
    drop_warmup=true,
    progress=false,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([[-0.25122541500555406, 0.10949673957567131, -1.2760126620865637, 0.29854282734653015, 0.5702695741149104], [-0.33939134831624396, 0.20289730119740146, -1.279207457287558, 0.23384721915315745, 0.5580955492728409], [-0.3861413059500781, 0.2615903264329002, -1.3257921467782952, -0.6523520765429105, 1.1576806552697079], [-0.20116610259414228, 0.08766423255609573, -1.2917322013392014, -0.5696086369947502, 1.1415835955932663], [-0.35154715422090316, 0.10953928846194039, -1.448211795496119, 0.6153849955017634, 0.4234094252877255], [-0.2598234565504887, 0.38117694499567395, -1.4001772704035118, -0.21764082156732534, 0.8545100189572536], [-0.20526705092035363, 0.11255864797095266, -0.5498448528027292, 0.24385734746463333, 0.3659834403761768], [-0.23549362540499888, 0.3506436200902892, -0.3838125138220584, 0.27319949739405724, 0.19178035903786067], [-0.3687525461367468, 0.4478828383740572, -0.3868505938527842, 0.40071498008762746, 0.05531114217025934], [-0.2758566070811565, 0.1690886053206629, -0.13376763960712315, -0.7277817420270554, 0.8304295396873803]  …  [-0.16904711547701828, 0.027638242841297275, 0.45478028943123644, 1.7751836027297698, -0.974213715082624], [-0.30601530927977555, 0.2029529721973256, 0.45897269949999986, 0.7468219773049534, -0.382390386929508], [-0.3494975976283472, 0.20547699663558305, 0.8012776638555965, 1.3483405610540067, -0.815823886870779], [-0.3667630664019049, 0.38850260918020174, 0.6826830289638169, 1.9723219924112663, -1.4221952967578604], [-0.29756632377136155, 0.313073804148892, 0.6283308452236328, 2.538074538462113, -1.668766033152742], [-0.39450660295703266, 0.08260082009269373, 1.1159469033109917, -1.8888447582926482, 1.223129062673224], [-0.3474738228177411, 0.07545525250990398, -0.259810474202108, -2.1250405782727113, 1.8476832909367193], [-0.2802353211332677, 0.18759156742284755, -0.7369190171494411, 1.4032850259034613, -0.31095059551137705], [-0.45391683086825146, 0.25088672721912963, -0.7193429702185627, -0.21719757328483758, 0.5868864698506385], [-0.2766700442304879, 0.41811569750651606, -0.6353542800368188, -1.6522101479641937, 1.5166479531753323]], NamedTuple[(n_steps = 3, is_accept = true, acceptance_rate = 0.9616395517999635, log_density = -114.4226996947398, hamiltonian_energy = 115.74777750310992, hamiltonian_energy_error = -0.08300905853583629, max_hamiltonian_energy_error = -0.2517782248622211, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.9995501118850814, log_density = -113.12145897961784, hamiltonian_energy = 114.36353060152204, hamiltonian_energy_error = -0.17774464669544443, max_hamiltonian_energy_error = -0.17774464669544443, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 31, is_accept = true, acceptance_rate = 0.7782903983645025, log_density = -114.01905701589037, hamiltonian_energy = 116.27169198517556, hamiltonian_energy_error = 0.08454206834366573, max_hamiltonian_energy_error = 0.5442009025646115, tree_depth = 5, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.7134813379438287, log_density = -116.34830759108945, hamiltonian_energy = 117.26119001875004, hamiltonian_energy_error = 0.36872020110278925, max_hamiltonian_energy_error = 0.36872020110278925, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.7620996223709318, log_density = -113.89216759153845, hamiltonian_energy = 117.5778241916345, hamiltonian_energy_error = -0.45215310482083737, max_hamiltonian_energy_error = 0.5427029502853884, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.606941351145413, log_density = -114.98998843929166, hamiltonian_energy = 116.48705960347638, hamiltonian_energy_error = 0.505243324275753, max_hamiltonian_energy_error = 1.0415304540837411, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 23, is_accept = true, acceptance_rate = 0.7132869870968319, log_density = -114.61980268867623, hamiltonian_energy = 119.56908952356599, hamiltonian_energy_error = -0.14326912596213504, max_hamiltonian_energy_error = 2.064510026657942, tree_depth = 4, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.7191347805123005, log_density = -113.8405083185036, hamiltonian_energy = 119.25731246007129, hamiltonian_energy_error = 0.009850870280530444, max_hamiltonian_energy_error = 1.0441543775726103, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.9735009824530925, log_density = -113.49377232953955, hamiltonian_energy = 114.74486876522873, hamiltonian_energy_error = -0.07202182398040691, max_hamiltonian_energy_error = -0.38931787410203356, tree_depth = 3, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.9398443490486214, log_density = -113.37783313284358, hamiltonian_energy = 114.43243625839756, hamiltonian_energy_error = -0.1914255107377727, max_hamiltonian_energy_error = -0.3465166556995456, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false)  …  (n_steps = 43, is_accept = true, acceptance_rate = 0.9950478515670514, log_density = -118.1522361275591, hamiltonian_energy = 121.43364434176263, hamiltonian_energy_error = -0.02714999448782862, max_hamiltonian_energy_error = -0.9530245956075163, tree_depth = 5, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 1.0, log_density = -112.93617106754782, hamiltonian_energy = 118.39005825043695, hamiltonian_energy_error = -0.7053571797275424, max_hamiltonian_energy_error = -0.7053571797275424, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 23, is_accept = true, acceptance_rate = 0.4791743326262729, log_density = -114.65680683422713, hamiltonian_energy = 117.64251258129848, hamiltonian_energy_error = 0.30127536306235925, max_hamiltonian_energy_error = 2.236641140982144, tree_depth = 4, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.8164467498179621, log_density = -117.922382635397, hamiltonian_energy = 118.80243857713953, hamiltonian_energy_error = 0.5203074765352937, max_hamiltonian_energy_error = 0.5203074765352937, tree_depth = 3, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.919237375912581, log_density = -117.26729833831413, hamiltonian_energy = 121.25533202271147, hamiltonian_energy_error = 0.13082722912334077, max_hamiltonian_energy_error = -0.4456696978781167, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 3, is_accept = true, acceptance_rate = 0.9779763588983382, log_density = -116.2612297603507, hamiltonian_energy = 118.36155243669779, hamiltonian_energy_error = 0.06835477865254802, max_hamiltonian_energy_error = -0.8461790555112145, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 43, is_accept = true, acceptance_rate = 0.9994334527959674, log_density = -116.85323720107162, hamiltonian_energy = 117.93557992726697, hamiltonian_energy_error = -0.04588100478909496, max_hamiltonian_energy_error = -0.766594093650113, tree_depth = 5, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.9536378444177022, log_density = -115.50883046348345, hamiltonian_energy = 119.7673936142155, hamiltonian_energy_error = -0.27859312719907336, max_hamiltonian_energy_error = -0.5365776975770729, tree_depth = 2, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 31, is_accept = true, acceptance_rate = 0.9382316547636954, log_density = -115.368321857462, hamiltonian_energy = 117.53057970441789, hamiltonian_energy_error = 0.19588269215893206, max_hamiltonian_energy_error = -0.49251957876650465, tree_depth = 4, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false), (n_steps = 15, is_accept = true, acceptance_rate = 0.990021836476401, log_density = -116.06454801454038, hamiltonian_energy = 117.80264543373924, hamiltonian_energy_error = -0.03871309815508539, max_hamiltonian_energy_error = -0.6043258864569623, tree_depth = 3, numerical_error = false, step_size = 0.8045475113906191, nom_step_size = 0.8045475113906191, is_adapt = false)])</code></pre><h3 id="Use-Pathfinder&#39;s-metric-estimate-for-sampling-2"><a class="docs-heading-anchor" href="#Use-Pathfinder&#39;s-metric-estimate-for-sampling-2">Use Pathfinder&#39;s metric estimate for sampling</a><a class="docs-heading-anchor-permalink" href="#Use-Pathfinder&#39;s-metric-estimate-for-sampling-2" title="Permalink"></a></h3><p>To use Pathfinder&#39;s metric with no metric adaptation, we need to use Pathfinder&#39;s own <code>RankUpdateEuclideanMetric</code> type, which just wraps our inverse metric estimate for use with AdvancedHMC:</p><pre><code class="language-julia hljs">nadapts = 75
metric = Pathfinder.RankUpdateEuclideanMetric(inv_metric)
hamiltonian = Hamiltonian(metric, logp, ForwardDiff)
ϵ = find_good_stepsize(hamiltonian, init_params)
integrator = Leapfrog(ϵ)
proposal = NUTS{MultinomialTS,GeneralisedNoUTurn}(integrator)
adaptor = StepSizeAdaptor(0.8, integrator)
samples_ahmc3, stats_ahmc3 = sample(
    hamiltonian,
    proposal,
    init_params,
    ndraws + nadapts,
    adaptor,
    nadapts;
    drop_warmup=true,
    progress=false,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([[-0.24902439848233077, -0.10991844254536567, -0.9601058268845304, -0.4828874992015843, 1.0834196002105945], [-0.1593486460421001, 0.5091704980971072, -0.1761761223524865, 1.0132015835315684, -0.5054938842392962], [-0.3226288887321947, 0.5110970258254058, -0.22079202914758256, 1.0051506835204442, -0.4804877297905012], [-0.17057540988828798, 0.1036963025353401, 0.018061641499443178, 1.7387258481246344, -0.7645512016987571], [-0.27829193312416994, 0.2355622342942481, 0.3329115668805658, -0.90233962261438, 0.7654695593497728], [-0.31001383875719823, 0.3479907919310838, 0.3825183914102286, -0.6011769706227986, 0.5014977531731996], [-0.3303344285193195, 0.3366067482479861, -1.4456779348771456, 0.6104301131317268, 0.29674285916513676], [-0.3814322147892073, 0.3868953929955496, 1.6927856155205765, -0.022184250450825838, -0.3399838281243075], [-0.29269727748162594, 0.303093598878723, 1.752188112354116, -0.017111759736629338, -0.3401770625679102], [-0.2865928692881079, 0.3035995142641702, 1.7550957423155387, 0.011548791906061374, -0.3052711052747081]  …  [-0.37534029793619605, 0.17391137718943453, 2.0118976119079255, -0.6229542625573892, 0.052684400885913224], [-0.2006197323534959, 0.21741690613596004, 1.4926743113242553, -1.2349423264591393, 0.6055889433267825], [-0.3527451367284729, 0.279238932711768, -1.3786716064458702, 1.4238163107986888, -0.19511790127905135], [-0.37735262870887354, 0.3133275259786561, -2.2287963361197747, 1.3023306309070248, 0.18496748206841507], [-0.28012971682808135, 0.2682554629275966, -1.910628544080617, 0.9083527023919126, 0.2780935351910749], [-0.46049742530576643, 0.19247145727512807, 0.28481249029216094, 1.603673416759744, -0.8780856564337735], [-0.2925506118247857, 0.33616913411196625, -0.5021653529708796, -0.3253339933615885, 0.6524153369151764], [-0.29641286646614756, 0.17615660132110744, -0.7151133703613524, -0.15358506441501324, 0.6140358097676234], [-0.40284229285388873, 0.28259163323869435, 0.9128884756419883, 0.028872424372777733, -0.08095193590401016], [-0.2960968774441115, 0.19134991833831114, 0.24228511483021206, 0.9371859360253901, -0.4055006725110227]], NamedTuple[(n_steps = 7, is_accept = true, acceptance_rate = 0.9749755369610215, log_density = -116.93441957853955, hamiltonian_energy = 119.7522884897536, hamiltonian_energy_error = -0.006846203157422792, max_hamiltonian_energy_error = 0.06556044280793571, tree_depth = 3, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9876464778497797, log_density = -117.49250512858642, hamiltonian_energy = 119.01619573158402, hamiltonian_energy_error = 0.05312277625782258, max_hamiltonian_energy_error = -0.10822424499127692, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.925510794647951, log_density = -114.71944218778974, hamiltonian_energy = 118.41413582374572, hamiltonian_energy_error = -0.20652585769509813, max_hamiltonian_energy_error = -0.20652585769509813, tree_depth = 3, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 39, is_accept = true, acceptance_rate = 0.8542634953057646, log_density = -117.8673236372395, hamiltonian_energy = 122.53616969665218, hamiltonian_energy_error = 0.2517828275926348, max_hamiltonian_energy_error = 0.3890002282557816, tree_depth = 5, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 79, is_accept = true, acceptance_rate = 0.9664142071853736, log_density = -113.3273709931619, hamiltonian_energy = 118.64847641532468, hamiltonian_energy_error = -0.23429459314347412, max_hamiltonian_energy_error = -0.39363699679080355, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 63, is_accept = true, acceptance_rate = 0.984492329252199, log_density = -112.86778891508858, hamiltonian_energy = 115.35264610745406, hamiltonian_energy_error = -0.012419991126392915, max_hamiltonian_energy_error = 0.049580828339799154, tree_depth = 5, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9999872355607389, log_density = -113.58951342454299, hamiltonian_energy = 115.68077486631158, hamiltonian_energy_error = -0.011225967456141461, max_hamiltonian_energy_error = -0.01512478204119816, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9055141499527674, log_density = -114.20077892980986, hamiltonian_energy = 115.96064188125276, hamiltonian_energy_error = 0.0067990454472379724, max_hamiltonian_energy_error = 0.22961763096560617, tree_depth = 7, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 15, is_accept = true, acceptance_rate = 0.9874421750265507, log_density = -114.09798008332146, hamiltonian_energy = 115.08966419676462, hamiltonian_energy_error = 0.007993080251026186, max_hamiltonian_energy_error = 0.03957094028302777, tree_depth = 3, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 7, is_accept = true, acceptance_rate = 0.8730921018654657, log_density = -114.63593707773983, hamiltonian_energy = 115.18928455123164, hamiltonian_energy_error = 0.12696593623030594, max_hamiltonian_energy_error = 0.2274446185148662, tree_depth = 2, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false)  …  (n_steps = 95, is_accept = true, acceptance_rate = 0.9856373365450172, log_density = -114.46275710878118, hamiltonian_energy = 118.21378878699986, hamiltonian_energy_error = -0.1525343428629924, max_hamiltonian_energy_error = -0.15605821958926924, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9254335313448646, log_density = -116.22828167369974, hamiltonian_energy = 118.3515797342215, hamiltonian_energy_error = 0.11097685200648755, max_hamiltonian_energy_error = 0.16686853111548317, tree_depth = 7, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9627502988689879, log_density = -114.51354988178942, hamiltonian_energy = 118.10085839366971, hamiltonian_energy_error = -0.0351889306522537, max_hamiltonian_energy_error = 0.21339352533333056, tree_depth = 7, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.8378446481186331, log_density = -117.22420543143139, hamiltonian_energy = 118.82764972551759, hamiltonian_energy_error = 0.3439247997991828, max_hamiltonian_energy_error = 0.4653070625299307, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 31, is_accept = true, acceptance_rate = 0.9007173404427807, log_density = -114.89050744154667, hamiltonian_energy = 119.73736981220927, hamiltonian_energy_error = -0.2924421649029654, max_hamiltonian_energy_error = -0.4853548959736287, tree_depth = 4, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9877753717417196, log_density = -115.20039731286478, hamiltonian_energy = 117.49256884795054, hamiltonian_energy_error = 0.04799469718476246, max_hamiltonian_energy_error = 0.05434125625711772, tree_depth = 7, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 71, is_accept = true, acceptance_rate = 0.8969989605132138, log_density = -113.42097800301843, hamiltonian_energy = 118.72028379891296, hamiltonian_energy_error = 0.15175346501267484, max_hamiltonian_energy_error = 0.25601997024028833, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9986522372980194, log_density = -113.23455862054934, hamiltonian_energy = 114.05239908741166, hamiltonian_energy_error = -0.038945283404203224, max_hamiltonian_energy_error = -0.15388979865939234, tree_depth = 7, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.9951862587888851, log_density = -112.82463834550275, hamiltonian_energy = 113.81550406992302, hamiltonian_energy_error = -0.09510694357319949, max_hamiltonian_energy_error = -0.11129879731430492, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false), (n_steps = 127, is_accept = true, acceptance_rate = 0.998880898541872, log_density = -112.96732477031665, hamiltonian_energy = 114.5211467621212, hamiltonian_energy_error = -0.007377424356391771, max_hamiltonian_energy_error = -0.022218336620696277, tree_depth = 6, numerical_error = false, step_size = 0.03094378812941628, nom_step_size = 0.03094378812941628, is_adapt = false)])</code></pre><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>https://mc-stan.org/docs/reference-manual/hmc-algorithm-parameters.html</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../quickstart/">« Quickstart</a><a class="docs-footer-nextpage" href="../turing/">Turing usage »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Wednesday 3 August 2022 10:49">Wednesday 3 August 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
